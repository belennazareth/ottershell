"use strict";(self.webpackChunkotter_shell=self.webpackChunkotter_shell||[]).push([[2821],{3905:(e,r,t)=>{t.d(r,{Zo:()=>c,kt:()=>u});var o=t(7294);function n(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function a(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function l(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?a(Object(t),!0).forEach((function(r){n(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function i(e,r){if(null==e)return{};var t,o,n=function(e,r){if(null==e)return{};var t,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)t=a[o],r.indexOf(t)>=0||(n[t]=e[t]);return n}(e,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)t=a[o],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(n[t]=e[t])}return n}var s=o.createContext({}),m=function(e){var r=o.useContext(s),t=r;return e&&(t="function"==typeof e?e(r):l(l({},r),e)),t},c=function(e){var r=m(e.components);return o.createElement(s.Provider,{value:r},e.children)},p={inlineCode:"code",wrapper:function(e){var r=e.children;return o.createElement(o.Fragment,{},r)}},d=o.forwardRef((function(e,r){var t=e.components,n=e.mdxType,a=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=m(t),u=n,v=d["".concat(s,".").concat(u)]||d[u]||p[u]||a;return t?o.createElement(v,l(l({ref:r},c),{},{components:t})):o.createElement(v,l({ref:r},c))}));function u(e,r){var t=arguments,n=r&&r.mdxType;if("string"==typeof e||n){var a=t.length,l=new Array(a);l[0]=d;var i={};for(var s in r)hasOwnProperty.call(r,s)&&(i[s]=r[s]);i.originalType=e,i.mdxType="string"==typeof e?e:n,l[1]=i;for(var m=2;m<a;m++)l[m]=t[m];return o.createElement.apply(null,l)}return o.createElement.apply(null,t)}d.displayName="MDXCreateElement"},141:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>s,contentTitle:()=>l,default:()=>p,frontMatter:()=>a,metadata:()=>i,toc:()=>m});var o=t(7462),n=(t(7294),t(3905));const a={sidebar_position:17},l="Gesti\xf3n de pool de almacenamiento l\xf3gico en KVM/libvirt",i={unversionedId:"Tasks/almacenamiento_kvm_libvirt",id:"Tasks/almacenamiento_kvm_libvirt",title:"Gesti\xf3n de pool de almacenamiento l\xf3gico en KVM/libvirt",description:"1. Crea con virsh un nuevo pool de almacenamiento de tipo l\xf3gico. Para ello, lo m\xe1s f\xe1cil, es tener un grupo de vol\xfamenes con espacio libre.",source:"@site/docs/Tasks/almacenamiento_kvm_libvirt.md",sourceDirName:"Tasks",slug:"/Tasks/almacenamiento_kvm_libvirt",permalink:"/docs/Tasks/almacenamiento_kvm_libvirt",draft:!1,editUrl:"https://github.com/belennazareth/ottershell/blob/main/docs/Tasks/almacenamiento_kvm_libvirt.md",tags:[],version:"current",sidebarPosition:17,frontMatter:{sidebar_position:17},sidebar:"tutorialSidebar",previous:{title:"Instalaci\xf3n/migraci\xf3n de aplicaciones web PHP",permalink:"/docs/Tasks/migracion_php"},next:{title:"Criptograf\xeda II: Integridad, firmas y autenticaci\xf3n",permalink:"/docs/Tasks/criptografia2"}},s={},m=[{value:"Entrega",id:"entrega",level:2}],c={toc:m};function p(e){let{components:r,...a}=e;return(0,n.kt)("wrapper",(0,o.Z)({},c,a,{components:r,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"gesti\xf3n-de-pool-de-almacenamiento-l\xf3gico-en-kvmlibvirt"},"Gesti\xf3n de pool de almacenamiento l\xf3gico en KVM/libvirt"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Crea con virsh un nuevo pool de almacenamiento de tipo l\xf3gico. Para ello, lo m\xe1s f\xe1cil, es tener un grupo de vol\xfamenes con espacio libre.")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"virsh -c qemu:///system pool-define-as --name pool1 --type logical --source-name /dev/vg01\n\nvirsh -c qemu:///system pool-start pool1\nvirsh -c qemu:///system v\n")),(0,n.kt)("p",null,"*Nota: ",(0,n.kt)("strong",{parentName:"p"},"IMPORTANTE")," primero hay que crearlo, luego definirlo y por \xfaltimo ativarlo."),(0,n.kt)("ol",{start:2},(0,n.kt)("li",{parentName:"ol"},"Crea un volumen en ese pool de almacenamiento. Comprueba que se ha creado un volumen l\xf3gico nuevo en el grupo de vol\xfamenes.")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"virsh -c qemu:///system vol-create-as pool1 vol_mv1 10G\n\nsudo lvs\n")),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"lvs",src:t(7677).Z,width:"871",height:"170"})),(0,n.kt)("ol",{start:3},(0,n.kt)("li",{parentName:"ol"},"Usa virt-install para crear una m\xe1quina virtual cuyo disco corresponda al volumen que has creado anteriormente.")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"virt-install --connect qemu:///system \\\n             --virt-type kvm \\\n             --name mv1 \\\n             --cdrom ~/Escritorio/ISOS/debian-11.5.0-amd64-netinst.iso \\\n             --os-variant debian10 \\\n             --disk=/dev/vg01/vol_mv1 \\\n             --memory 1024 \\\n             --vcpus 1\n")),(0,n.kt)("p",null,"*Nota: en ",(0,n.kt)("strong",{parentName:"p"},"ZSH")," no funciona el comando con los espacios, por lo que hay que usar el comando con los par\xe1metros en una sola l\xednea."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"virt-install --connect qemu:///system --virt-type kvm --name mv1 --cdrom ~/Escritorio/ISOS/debian-11.5.0-amd64-netinst.iso --os-variant debian10 --disk=/dev/vg01/vol_mv1 --memory 1024 --vcpus 1\n")),(0,n.kt)("ol",{start:4},(0,n.kt)("li",{parentName:"ol"},"Una vez que la m\xe1quina este funcionando, crea un nuevo volumen y a\xf1\xe1delo a la m\xe1quina.")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"virsh -c qemu:///system vol-create-as pool1 vol_mv2 2G\nvirsh -c qemu:///system attach-disk mv1 /dev/vg01/vol_mv2 vdb --persistent\n")),(0,n.kt)("ol",{start:5},(0,n.kt)("li",{parentName:"ol"},"Apaga la m\xe1quina, y siguiendo el art\xedculo ",(0,n.kt)("a",{parentName:"li",href:"https://albertomolina.wordpress.com/2009/12/14/acceder-a-una-imagen-de-disco-kvm-ubicada-en-un-volumen-logico/"},"Acceder a una imagen de disco KVM ubicada en un volumen l\xf3gico")," monta la partici\xf3n del disco de la m\xe1quina en tu anfitri\xf3n para acceder a sistema de archivos.")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"virsh -c qemu:///system shutdown mv1\n")),(0,n.kt)("p",null,"Para montar la partici\xf3n del disco de la m\xe1quina en tu anfitri\xf3n para acceder a sistema de archivos:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"sudo kpartx -va /dev/vg01/vol_mv1\nls -l /dev/mapper\n")),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"KP",src:t(5918).Z,width:"686",height:"232"}),"\n",(0,n.kt)("img",{alt:"KP",src:t(1294).Z,width:"706",height:"304"})),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"mount /dev/mapper/vg01-vol_mv1p1 /mnt_vg/ #como root\nls -l /mnt_vg/\n")),(0,n.kt)("p",null,"Con salida:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"root@ThousandSunny:~# mount /dev/mapper/vg01-vol_mv1p1 /mnt_vg/\nroot@ThousandSunny:~# ls -l /mnt_vg/\ntotal 76\n\nlrwxrwxrwx  1 root root     7 feb  2 10:20 bin -> usr/bin\ndrwxr-xr-x  3 root root  4096 feb  2 10:25 boot\ndrwxr-xr-x  4 root root  4096 feb  2 10:20 dev\ndrwxr-xr-x 68 root root  4096 feb  2 10:26 etc\ndrwxr-xr-x  3 root root  4096 feb  2 10:25 home\nlrwxrwxrwx  1 root root    31 feb  2 10:22 initrd.img -> boot/initrd.img-5.10.0-21-amd64\nlrwxrwxrwx  1 root root    31 feb  2 10:20 initrd.img.old -> boot/initrd.img-5.10.0-18-amd64\nlrwxrwxrwx  1 root root     7 feb  2 10:20 lib -> usr/lib\nlrwxrwxrwx  1 root root     9 feb  2 10:20 lib32 -> usr/lib32\nlrwxrwxrwx  1 root root     9 feb  2 10:20 lib64 -> usr/lib64\nlrwxrwxrwx  1 root root    10 feb  2 10:20 libx32 -> usr/libx32\ndrwx------  2 root root 16384 feb  2 10:20 lost+found\ndrwxr-xr-x  3 root root  4096 feb  2 10:20 media\ndrwxr-xr-x  2 root root  4096 feb  2 10:20 mnt\ndrwxr-xr-x  2 root root  4096 feb  2 10:20 opt\ndrwxr-xr-x  2 root root  4096 sep  3 14:10 proc\ndrwx------  2 root root  4096 feb  2 10:20 root\ndrwxr-xr-x  2 root root  4096 feb  2 10:26 run\nlrwxrwxrwx  1 root root     8 feb  2 10:20 sbin -> usr/sbin\ndrwxr-xr-x  2 root root  4096 feb  2 10:20 srv\ndrwxr-xr-x  2 root root  4096 sep  3 14:10 sys\ndrwxrwxrwt  7 root root  4096 feb  2 10:36 tmp\ndrwxr-xr-x 14 root root  4096 feb  2 10:20 usr\ndrwxr-xr-x 11 root root  4096 feb  2 10:20 var\nlrwxrwxrwx  1 root root    28 feb  2 10:22 vmlinuz -> boot/vmlinuz-5.10.0-21-amd64\nlrwxrwxrwx  1 root root    28 feb  2 10:20 vmlinuz.old -> boot/vmlinuz-5.10.0-18-amd64\n")),(0,n.kt)("h2",{id:"entrega"},"Entrega"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"1. Instrucci\xf3n para crear el pool de almacenamiento.")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"2. Instrucci\xf3n para crear el volumen.")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"3. Una vez instalado el sistema, la configuraci\xf3n XML de la m\xe1quina donde se ve el almacenamiento de la misma (se deben ver los dos discos).")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"4. Las instrucciones ejecutadas para montar la partici\xf3n del disco, y la lista de ficheros del sistema de archivos.")))}p.isMDXComponent=!0},5918:(e,r,t)=>{t.d(r,{Z:()=>o});const o=t.p+"assets/images/taller1SRI7-2-abad413f3a5020b28094fd53ab151ab5.png"},1294:(e,r,t)=>{t.d(r,{Z:()=>o});const o=t.p+"assets/images/taller1SRI7-3-992563b4ecb44ccf485c36d94ac123e0.png"},7677:(e,r,t)=>{t.d(r,{Z:()=>o});const o=t.p+"assets/images/taller1SRI7-a6f5750e7d6cb819140216f923da4bfa.png"}}]);