"use strict";(self.webpackChunkotter_shell=self.webpackChunkotter_shell||[]).push([[2722],{3905:(e,a,n)=>{n.d(a,{Zo:()=>d,kt:()=>m});var t=n(7294);function o(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function l(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,t)}return n}function r(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?l(Object(n),!0).forEach((function(a){o(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function i(e,a){if(null==e)return{};var n,t,o=function(e,a){if(null==e)return{};var n,t,o={},l=Object.keys(e);for(t=0;t<l.length;t++)n=l[t],a.indexOf(n)>=0||(o[n]=e[n]);return o}(e,a);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(t=0;t<l.length;t++)n=l[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=t.createContext({}),p=function(e){var a=t.useContext(s),n=a;return e&&(n="function"==typeof e?e(a):r(r({},a),e)),n},d=function(e){var a=p(e.components);return t.createElement(s.Provider,{value:a},e.children)},c={inlineCode:"code",wrapper:function(e){var a=e.children;return t.createElement(t.Fragment,{},a)}},u=t.forwardRef((function(e,a){var n=e.components,o=e.mdxType,l=e.originalType,s=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),u=p(n),m=o,g=u["".concat(s,".").concat(m)]||u[m]||c[m]||l;return n?t.createElement(g,r(r({ref:a},d),{},{components:n})):t.createElement(g,r({ref:a},d))}));function m(e,a){var n=arguments,o=a&&a.mdxType;if("string"==typeof e||o){var l=n.length,r=new Array(l);r[0]=u;var i={};for(var s in a)hasOwnProperty.call(a,s)&&(i[s]=a[s]);i.originalType=e,i.mdxType="string"==typeof e?e:o,r[1]=i;for(var p=2;p<l;p++)r[p]=n[p];return t.createElement.apply(null,r)}return t.createElement.apply(null,n)}u.displayName="MDXCreateElement"},3896:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>s,contentTitle:()=>r,default:()=>c,frontMatter:()=>l,metadata:()=>i,toc:()=>p});var t=n(7462),o=(n(7294),n(3905));const l={sidebar_position:24},r="Despliegue de aplicaciones python",i={unversionedId:"Tasks/despliegue_python",id:"Tasks/despliegue_python",title:"Despliegue de aplicaciones python",description:"Procedimiento",source:"@site/docs/Tasks/despliegue_python.md",sourceDirName:"Tasks",slug:"/Tasks/despliegue_python",permalink:"/docs/Tasks/despliegue_python",draft:!1,editUrl:"https://github.com/belennazareth/ottershell/blob/main/docs/Tasks/despliegue_python.md",tags:[],version:"current",sidebarPosition:24,frontMatter:{sidebar_position:24},sidebar:"tutorialSidebar",previous:{title:"Despliegue de aplicaciones Java",permalink:"/docs/Tasks/despliegue_java"},next:{title:"Redes Privadas Virtuales",permalink:"/docs/Tasks/vpn"}},s={},p=[{value:"Procedimiento",id:"procedimiento",level:2},{value:"Entorno de desarrollo",id:"entorno-de-desarrollo",level:3},{value:"Entorno de producci\xf3n",id:"entorno-de-producci\xf3n",level:3},{value:"Modificaci\xf3n de nuestra aplicaci\xf3n",id:"modificaci\xf3n-de-nuestra-aplicaci\xf3n",level:3},{value:"Desarrollo",id:"desarrollo",level:4},{value:"Producci\xf3n",id:"producci\xf3n",level:4}],d={toc:p};function c(e){let{components:a,...l}=e;return(0,o.kt)("wrapper",(0,t.Z)({},d,l,{components:a,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"despliegue-de-aplicaciones-python"},"Despliegue de aplicaciones python"),(0,o.kt)("h2",{id:"procedimiento"},"Procedimiento"),(0,o.kt)("h3",{id:"entorno-de-desarrollo"},"Entorno de desarrollo"),(0,o.kt)("p",null,"Lo primero ser\xe1 crear el entorno virtual y activarlo:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir venv  \ncd venv\n\npython3 -m venv django\nsource django/bin/activate\n")),(0,o.kt)("p",null,"Adem\xe1s, instalaremos la aplicaci\xf3n de Django:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"pip install django\n")),(0,o.kt)("p",null,"Despu\xe9s de realizar un fork del ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/josedom24/django_tutorial"},"repositorio de la aplicaci\xf3n"),", clonaremos el repositorio en la m\xe1quina local usando el comando ",(0,o.kt)("inlineCode",{parentName:"p"},"git clone")," con el ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/belennazareth/django_tutorial"},"repositorio"),"."),(0,o.kt)("p",null,"Para usar esta aplicaci\xf3n se va a trabajar usando una base de datos SQLite, por lo que no es necesario instalar ning\xfan servicio de base de datos. Para consultar el nombre de la base de datos, se puede ver el fichero ",(0,o.kt)("inlineCode",{parentName:"p"},"/django_tutorial/settings.py")," y vemos que su nombre es ",(0,o.kt)("inlineCode",{parentName:"p"},"db.sqlite3"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"# Database\n# https://docs.djangoproject.com/en/3.1/ref/settings/#databases\n\nDATABASES = {\n    'default': {\n        'ENGINE': 'django.db.backends.sqlite3',\n        'NAME': BASE_DIR / 'db.sqlite3',\n    }\n}\n")),(0,o.kt)("p",null,"A continuaci\xf3n, se va a crear una base de datos vac\xeda para la aplicaci\xf3n y un superusuario para poder acceder a la aplicaci\xf3n:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"python manage.py migrate\npython manage.py createsuperuser\n")),(0,o.kt)("p",null,"Adem\xe1s, es necesario editar el fichero ",(0,o.kt)("inlineCode",{parentName:"p"},"django_tutorial/settings.py")," y modificar la variable ",(0,o.kt)("inlineCode",{parentName:"p"},"ALLOWED_HOSTS")," para que pueda acceder sin problemas a la aplicaci\xf3n desde cualquier host:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"ALLOWED_HOSTS = ['*']\n")),(0,o.kt)("p",null,"Para poder acceder, como estamos usando ",(0,o.kt)("inlineCode",{parentName:"p"},"bravo"),", debemos a\xf1adir una nueva regla ",(0,o.kt)("strong",{parentName:"p"},"DNAT")," para que se redirija el tr\xe1fico de la m\xe1quina ",(0,o.kt)("inlineCode",{parentName:"p"},"bravo")," al puerto ",(0,o.kt)("inlineCode",{parentName:"p"},"8000")," de la m\xe1quina ",(0,o.kt)("inlineCode",{parentName:"p"},"alfa")," editando el fichero ",(0,o.kt)("inlineCode",{parentName:"p"},"/etc/network/interfaces.d/50-cloud-init"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"post-up iptables -t nat -A PREROUTING -p tcp --dport 8000 -i ens3 -j DNAT --to 172.16.0.200\n")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"py",src:n(9970).Z,width:"1025",height:"622"})),(0,o.kt)("p",null,"Y reiniciamos la maquina para que se apliquen los cambios. "),(0,o.kt)("p",null,"Lo siguiente es ejecutar el servidor web de desarrollo para comprobar los datos que se han modificado entrando en la zona de administraci\xf3n de la aplicaci\xf3n (",(0,o.kt)("inlineCode",{parentName:"p"},"/admin"),"):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"python manage.py runserver 0.0.0.0:8000\n")),(0,o.kt)("p",null,"Aparecer\xe1 una pantalla como la siguiente:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"py",src:n(2883).Z,width:"1089",height:"915"})),(0,o.kt)("p",null,"Si entramos en la zona de administraci\xf3n de la aplicaci\xf3n (",(0,o.kt)("inlineCode",{parentName:"p"},"/admin"),"), aparecer\xe1 una pantalla como la siguiente:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"py",src:n(8609).Z,width:"887",height:"692"})),(0,o.kt)("p",null,"Lo siguiente ser\xe1 entrar como administrador y crear un par de cuestiones. El usuario y contrase\xf1a que pide la p\xe1gina ",(0,o.kt)("inlineCode",{parentName:"p"},"/admin")," es el que se ha creado con el comando ",(0,o.kt)("inlineCode",{parentName:"p"},"python manage.py createsuperuser"),":"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"py",src:n(7100).Z,width:"887",height:"692"}),"\n",(0,o.kt)("img",{alt:"py",src:n(8283).Z,width:"1181",height:"806"})),(0,o.kt)("p",null,"Una vez creadas las preguntas, podemos comprobar que se han creado correctamente entrando en ",(0,o.kt)("inlineCode",{parentName:"p"},"/polls"),":"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"py",src:n(4714).Z,width:"889",height:"575"}),"\n",(0,o.kt)("img",{alt:"py",src:n(4401).Z,width:"889",height:"575"}),"\n",(0,o.kt)("img",{alt:"py",src:n(1740).Z,width:"889",height:"575"})),(0,o.kt)("p",null,"Si entramos en la zona de administraci\xf3n de la aplicaci\xf3n (",(0,o.kt)("inlineCode",{parentName:"p"},"/admin"),"), y seleccionamos una de las dos preguntas que hemos creado, aparecer\xe1 una pantalla como la siguiente mostrando los detalles de la pregunta y las votaciones que ha recibido:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"py",src:n(9538).Z,width:"1392",height:"823"})),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Configura el servidor web apache2 con el m\xf3dulo wsgi para servir la p\xe1gina web. Si utilizas como entorno de desarrollo la m\xe1quina bravo, se acceder\xe1 con el nombre python.tunombre.gonzalonazareno.org.")),(0,o.kt)("p",null,"A continuaci\xf3n, vamos a ",(0,o.kt)("strong",{parentName:"p"},"configurar el servidor web Apache")," para que pueda servir la aplicaci\xf3n Django usando wsgi. Para ello, debemos instalar el m\xf3dulo para wsgi:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo dnf install python3-mod_wsgi\n")),(0,o.kt)("p",null,"*Nota: Para hacer este apartado se han usado los talleres: ",(0,o.kt)("a",{parentName:"p",href:"https://ottershell.vercel.app/docs/Tasks/apache_wsgi"},"Desplegando aplicaciones flask con apache2 + mod_wsgi")," y ",(0,o.kt)("a",{parentName:"p",href:"https://ottershell.vercel.app/docs/Tasks/apache_uwsgi"},"Desplegando aplicaciones flask con apache2/nginx + uwsgi")),(0,o.kt)("p",null,"Movemos el directorio ",(0,o.kt)("inlineCode",{parentName:"p"},"django_tutorial")," y el entorno virtual a la carpeta ",(0,o.kt)("inlineCode",{parentName:"p"},"/var/www/html")," para que sea accesible desde el servidor web:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"mv github/django_tutorial /var/www/html\nmv venv/django /var/www/html\n")),(0,o.kt)("p",null,"Lo siguiente ser\xe1 editar el fichero ",(0,o.kt)("inlineCode",{parentName:"p"},"django_tutorial/settings.py")," y modificar la variable ",(0,o.kt)("inlineCode",{parentName:"p"},"ALLOWED_HOSTS")," para que pueda acceder sin problemas a la aplicaci\xf3n desde cualquier host y a\xf1adimos ",(0,o.kt)("inlineCode",{parentName:"p"},"STATIC_ROOT")," para que se pueda acceder a los ficheros est\xe1ticos:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"ALLOWED_HOSTS = ['*']\nSTATIC_ROOT = '/var/www/html/django_tutorial/static/'\n")),(0,o.kt)("p",null,"Dentro de ",(0,o.kt)("inlineCode",{parentName:"p"},"django_tutorial")," creamos el contenido est\xe1tico de la aplicaci\xf3n:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo python3 manage.py collectstatic\n")),(0,o.kt)("p",null,"Creamos un fichero de configuraci\xf3n para el servidor apache, ",(0,o.kt)("inlineCode",{parentName:"p"},"/etc/httpd/sites-available/django_apache.conf"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"<VirtualHost *:80>\n\n    ServerName python.nazareth.gonzalonazareno.org\n    DocumentRoot /var/www/html/django_tutorial\n\n    Alias /static/ /var/www/html/django_tutorial/static/\n\n    WSGIDaemonProcess django_tutorial python-path=/var/www/html/django_tutorial:/var/www/html/django/lib/python3.9/site-packages\n    WSGIProcessGroup django_tutorial\n    WSGIScriptAlias / /var/www/html/django_tutorial/django_tutorial/wsgi.py\n\n    ErrorLog /var/log/httpd/django_tutorial_error.log\n    CustomLog /var/log/httpd/django_tutorial_access.log combined\n</VirtualHost>\n")),(0,o.kt)("p",null,"Y lo activamos:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo ln -s /etc/httpd/sites-available/django_apache.conf /etc/httpd/sites-enabled/\nsudo systemctl restart httpd\n")),(0,o.kt)("p",null,"Ya podemos entrar en la aplicaci\xf3n desde el navegador introduciendo la direcci\xf3n:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"python.nazareth.gonzalonazareno.org\n")),(0,o.kt)("h3",{id:"entorno-de-producci\xf3n"},"Entorno de producci\xf3n"),(0,o.kt)("p",null,"Vamos a realizar el despliegue de nuestra aplicaci\xf3n en un entorno de producci\xf3n, para ello vamos a utilizar nuestro VPS."),(0,o.kt)("p",null,"Lo primero ser\xe1 clonar el repositorio de la aplicaci\xf3n en el VPS:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/belennazareth/django_tutorial.git\n")),(0,o.kt)("p",null,"Instalamos python3 y pip3:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"apt-get install python3-venv\napt-get install python3-pip\n")),(0,o.kt)("p",null,"Creamos un entorno virtual para la aplicaci\xf3n y lo activamos:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"python3 -m venv venv/django\nsource venv/django/bin/activate\n")),(0,o.kt)("p",null,"Instalamos las dependencias de la aplicaci\xf3n:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"pip install -r django_tutorial/requirements.txt\n")),(0,o.kt)("p",null,"Necesitamos poder trabajar con mysql desde python, para ello instalamos el conector:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt install libmariadb-dev\npip install mysqlclient\npip install pymysql\n")),(0,o.kt)("p",null,"Creamos la base de datos y el usuario para la aplicaci\xf3n, es importante que el usuario y la contrase\xf1a sean los mismos que en sqlite:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo mysql \n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE DATABASE django;\nCREATE USER 'django'@'localhost' IDENTIFIED BY 'django';\nGRANT ALL PRIVILEGES ON django.* TO 'django'@'localhost';\nFLUSH PRIVILEGES;\n")),(0,o.kt)("p",null,"Modificamos el fichero ",(0,o.kt)("inlineCode",{parentName:"p"},"django_tutorial/settings.py")," para que la aplicaci\xf3n pueda conectarse a la base de datos:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"DATABASES = {\n    'default': {\n        'ENGINE': 'django.db.backends.mysql',\n        'NAME': 'django',\n        'USER': 'django',\n        'PASSWORD': 'django',\n        'HOST': 'localhost',\n        'PORT': '',\n    }\n}\n")),(0,o.kt)("p",null,"En bravo, creamos una copia de seguridad de la aplicaci\xf3n:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo python3 manage.py dumpdata > db.json\n")),(0,o.kt)("p",null,"Subimos la copia al repositorio:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'git add db.json\ngit commit -m "Copia de seguridad"\ngit push\n')),(0,o.kt)("p",null,"En la m\xe1quina del VPS, actualizamos el repositorio:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"git pull\n")),(0,o.kt)("p",null,"Y restauramos la copia de seguridad en el VPS:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"python3 manage.py migrate\npython3 manage.py loaddata db.json\n")),(0,o.kt)("p",null,"Editamos el fichero ",(0,o.kt)("inlineCode",{parentName:"p"},"django_tutorial/settings.py")," para que la aplicaci\xf3n pueda servir los ficheros est\xe1ticos:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"ALLOWED_HOSTS = ['*']\nSTATIC_ROOT = '/home/poke/django_tutorial/static/'\n")),(0,o.kt)("p",null,"Y generamos el contenido est\xe1tico:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"python3 manage.py collectstatic\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Configuraremos nginx")," instalando primero el paquete ",(0,o.kt)("inlineCode",{parentName:"p"},"nginx")," y ",(0,o.kt)("inlineCode",{parentName:"p"},"uwsgi"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt install nginx\npip install uwsgi\n")),(0,o.kt)("p",null,"Creamos dentro de la carpeta del entorno virtual el fichero de configuraci\xf3n de nginx, ",(0,o.kt)("inlineCode",{parentName:"p"},"/home/poke/venv/django/servidor.ini"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"[uwsgi]\nhttp = :8080\nchdir = /home/poke/django_tutorial \nwsgi-file = django_tutorial/wsgi.py\nprocesses = 4\nthreads = 2\n")),(0,o.kt)("p",null,"Como vimos en el taller, creamos una unidad systemd para que el servicio se inicie autom\xe1ticamente editando el fichero ",(0,o.kt)("inlineCode",{parentName:"p"},"/etc/systemd/system/uwsgi-django.service"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"[Unit]\nDescription=uwsgi-django\nAfter=network.target\n\n[Install]\nWantedBy=multi-user.target\n\n[Service]\nUser=www-data\nGroup=www-data\nRestart=always\n\nExecStart=/home/poke/venv/django/bin/uwsgi /home/poke/venv/django/servidor.ini\nExecReload=/bin/kill -s HUP $MAINPID\nExecStop=/bin/kill -s TERM $MAINPID\n\nWorkingDirectory=/home/poke/django_tutorial\nEnvironment=PYTHONPATH='/home/poke/django_tutorial:/home/poke/venv/django/lib/python3.9/site-packages'\n\nPrivateTmp=true\n")),(0,o.kt)("p",null,"Y lo activamos:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl enable uwsgi-django\nsudo systemctl start uwsgi-django\n")),(0,o.kt)("p",null,"Por \xfaltimo, creamos el fichero de configuraci\xf3n de nginx, ",(0,o.kt)("inlineCode",{parentName:"p"},"/etc/nginx/sites-available/django.conf")," copiando el existente con https y cambiando la l\xednea ",(0,o.kt)("inlineCode",{parentName:"p"},"location /")," y servername por ",(0,o.kt)("inlineCode",{parentName:"p"},"python.ottershell.es"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"server {\n    listen 80;\n    listen 443 ssl http2;\n\n    server_name pyhton.ottershell.es;\n\n    access_log /var/log/nginx/python.com-access.log;\n    error_log /var/log/nginx/python.com-error.log;\n\n    ssl_certificate    /etc/letsencrypt/live/ottershell.es/fullchain.pem;\n    ssl_certificate_key    /etc/letsencrypt/live/ottershell.es/privkey.pem;\n\n    root /home/poke/django_tutorial;\n\n    index index.php;\n    location / {\n    proxy_pass http://localhost:8080;\n    include proxy_params;\n    }\n    location /static/polls {\n    alias /home/poke/django_tutorial/polls/static/polls;\n    }\n    location /static/admin {\n    alias /home/poke/venv/django/lib/python3.9/site-packages/django/contrib/admin/static/admin/;\n    }\n}\n\n")),(0,o.kt)("p",null,"Desactivamos el DEBUG en el fichero ",(0,o.kt)("inlineCode",{parentName:"p"},"django_tutorial/settings.py")," para que no se muestren los errores y den informaci\xf3n sensible:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"DEBUG = False\n")),(0,o.kt)("p",null,"Creamos el enlace simb\xf3lico y reiniciamos el servicio:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo ln -s /etc/nginx/sites-available/django /etc/nginx/sites-enabled/\nsudo systemctl restart nginx\n")),(0,o.kt)("p",null,"En la p\xe1gina donde tenemos contratado el dominio, a\xf1adimos un nuevo registro de tipo ",(0,o.kt)("inlineCode",{parentName:"p"},"CNAME")," con el nombre ",(0,o.kt)("inlineCode",{parentName:"p"},"python")," y el valor ",(0,o.kt)("inlineCode",{parentName:"p"},"ottershell.es"),"."),(0,o.kt)("p",null,"Si entramos en python.ottershell.es, veremos nuestra aplicaci\xf3n funcionando:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"py",src:n(4275).Z,width:"1352",height:"941"}),"\n",(0,o.kt)("img",{alt:"py",src:n(6905).Z,width:"895",height:"570"}),"\n",(0,o.kt)("img",{alt:"py",src:n(8357).Z,width:"895",height:"570"})),(0,o.kt)("h3",{id:"modificaci\xf3n-de-nuestra-aplicaci\xf3n"},"Modificaci\xf3n de nuestra aplicaci\xf3n"),(0,o.kt)("p",null,"Las modificaciones se realizar\xe1n en el entorno de desarrollo, en mi caso ",(0,o.kt)("inlineCode",{parentName:"p"},"bravo"),". Una vez realizadas, se subir\xe1n al repositorio y se actualizar\xe1 el entorno de producci\xf3n."),(0,o.kt)("h4",{id:"desarrollo"},"Desarrollo"),(0,o.kt)("p",null,"Modificamos la p\xe1gina inicial donde se ven las encuestas para que aparezca tu nombre editando el archivo ",(0,o.kt)("inlineCode",{parentName:"p"},"django_tutorial/polls/templates/index.html"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html lang="es">\n\n<head>\n  <meta charset="UTF-8" />\n  <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n  <title>Django Tutorial</title>\n\n  <link rel="stylesheet"\n    href="https://fonts.googleapis.com/css2?family=Almarai:wght@800&amp;family=Nunito+Sans&amp;display=swap" />\n</head>\n\n<body>\n  <div class="container">\n    <div class="content">\n      <img src="https://dit.gonzalonazareno.org/gestiona/static/img/iesgn.jpg" alt="DigitalOcean Logo" width="100" />\n      <h1>Aplicaci\xf3n <a href="https://www.djangoproject.com/">Django Tutorial</a>!<br>Belen Nazareth Duran Melendez</h1>\n')),(0,o.kt)("p",null,"Modificamos la imagen que se ve de fondo en la p\xe1gina de inicio a\xf1adiendo una nueva imagen en ",(0,o.kt)("inlineCode",{parentName:"p"},"django_tutorial/polls/static/polls/images")," y editando el archivo ",(0,o.kt)("inlineCode",{parentName:"p"},"django_tutorial/polls/static/polls/style.css"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-css"},'li a {\n    color: black;\n    background-color: blanchedalmond;\n}\n\nbody {\n    background: white url("images/background3.jpg");\n}\n')),(0,o.kt)("p",null,"Vamos a crear una nueva tabla en la base de datos siguiendo estos pasos:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Creamos un nuevo modelo en ",(0,o.kt)("inlineCode",{parentName:"li"},"django_tutorial/polls/models.py"),":")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'class Categoria(models.Model):\n    Abr = models.CharField(max_length=4)\n    Nombre = models.CharField(max_length=50)\n\n    def __str__(self):\n        return self.Abr+" - "+self.Nombre\n')),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"Creamos las migraciones:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo python3 manage.py makemigrations --name nueva_categoria\nsudo python3 manage.py migrate\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Obtenemos una salida parecida a esta:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"(django) [nazare@bravo django_tutorial]$ sudo python3 manage.py makemigrations --name nueva_categoria\n\nMigrations for 'polls':\n  polls/migrations/0002_nueva_categoria.py\n    - Create model Categoria\n\n(django) [nazare@bravo django_tutorial]$ sudo python3 manage.py migrate\n\nOperations to perform:\n  Apply all migrations: admin, auth, contenttypes, polls, sessions\nRunning migrations:\n  Applying polls.0002_nueva_categoria... OK\n")),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"A\xf1adimos el nuevo modelo a la interfaz de administraci\xf3n en ",(0,o.kt)("inlineCode",{parentName:"li"},"django_tutorial/polls/admin.py")," cambiando la l\xednea ",(0,o.kt)("inlineCode",{parentName:"li"},"from .models import Question")," por:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"from .models import Choice, Question, Categoria\n")),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},"Al final del fichero, a\xf1adimos:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"admin.site.register(Categoria)\n")),(0,o.kt)("ol",{start:5},(0,o.kt)("li",{parentName:"ol"},"Para poder trasladar los cambios:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'sudo python3 manage.py \nsudo python3 manage.py dumpdata > db2.json\nsudo python3 manage.py collectstatic\ngit add *\ngit commit -m "A\xf1adida nueva tabla + cambios en la p\xe1gina de inicio"\ngit push\n')),(0,o.kt)("h4",{id:"producci\xf3n"},"Producci\xf3n"),(0,o.kt)("p",null,"Realizamos los cambios en el entorno de producci\xf3n:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"git pull\npython3.9 manage.py migrate\npython3.9 manage.py loaddata db2.json\npython3.9 manage.py collectstatic\n")),(0,o.kt)("p",null,"Y vemos como se ha actualizado la p\xe1gina de inicio:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"py",src:n(380).Z,width:"1089",height:"915"}),"\n",(0,o.kt)("img",{alt:"py",src:n(2332).Z,width:"921",height:"543"})),(0,o.kt)("p",null,"*Nota: Activar los entornos virtuales, en bravo ahora esta en /var/www/, no usar emojis en sqlite, las maquinas usadas son bravo y buizel con usuario poke"))}c.isMDXComponent=!0},4275:(e,a,n)=>{n.d(a,{Z:()=>t});const t=n.p+"assets/images/desplieguePYIAW4-11-a666483e9951f5fed10b1838132df5e9.png"},6905:(e,a,n)=>{n.d(a,{Z:()=>t});const t=n.p+"assets/images/desplieguePYIAW4-12-cd85c29a098cc35ce7a4240dce9ff223.png"},8357:(e,a,n)=>{n.d(a,{Z:()=>t});const t=n.p+"assets/images/desplieguePYIAW4-13-bd12645a445446b67d1fb356e3273abf.png"},380:(e,a,n)=>{n.d(a,{Z:()=>t});const t=n.p+"assets/images/desplieguePYIAW4-14-1cf66c294fcb38dea0c14b34750dfc37.png"},2332:(e,a,n)=>{n.d(a,{Z:()=>t});const t=n.p+"assets/images/desplieguePYIAW4-15-00bb9a58592f1d78ee12d7ec9b093544.png"},2883:(e,a,n)=>{n.d(a,{Z:()=>t});const t=n.p+"assets/images/desplieguePYIAW4-2-33a6753e859e696389a7e6a4cbde7f42.png"},8609:(e,a,n)=>{n.d(a,{Z:()=>t});const t=n.p+"assets/images/desplieguePYIAW4-3-4b13ab11b508916adb04c26d0d5c7386.png"},7100:(e,a,n)=>{n.d(a,{Z:()=>t});const t=n.p+"assets/images/desplieguePYIAW4-4-077137bc4dc50775d5791f08d7f7df80.png"},8283:(e,a,n)=>{n.d(a,{Z:()=>t});const t=n.p+"assets/images/desplieguePYIAW4-5-f584621eb51dad42d5523939462bbfe0.png"},4714:(e,a,n)=>{n.d(a,{Z:()=>t});const t=n.p+"assets/images/desplieguePYIAW4-6-e39c1fcc3989fa558d77572454dda3a7.png"},4401:(e,a,n)=>{n.d(a,{Z:()=>t});const t=n.p+"assets/images/desplieguePYIAW4-7-da1c24c5480823f71ed72c2192b68b22.png"},1740:(e,a,n)=>{n.d(a,{Z:()=>t});const t=n.p+"assets/images/desplieguePYIAW4-8-ea648a92011097cf6b89690ebd670cf9.png"},9538:(e,a,n)=>{n.d(a,{Z:()=>t});const t=n.p+"assets/images/desplieguePYIAW4-9-f44a78ccd281fc36d687c7c0e15d81eb.png"},9970:(e,a,n)=>{n.d(a,{Z:()=>t});const t=n.p+"assets/images/desplieguePYIAW4-192853ea344c748fc8ce2367fe058b9e.png"}}]);