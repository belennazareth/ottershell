"use strict";(self.webpackChunkotter_shell=self.webpackChunkotter_shell||[]).push([[9214],{3905:(e,n,a)=>{a.d(n,{Zo:()=>d,kt:()=>m});var r=a(7294);function t(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function o(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,r)}return a}function i(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?o(Object(a),!0).forEach((function(n){t(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function l(e,n){if(null==e)return{};var a,r,t=function(e,n){if(null==e)return{};var a,r,t={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],n.indexOf(a)>=0||(t[a]=e[a]);return t}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(t[a]=e[a])}return t}var s=r.createContext({}),c=function(e){var n=r.useContext(s),a=n;return e&&(a="function"==typeof e?e(n):i(i({},n),e)),a},d=function(e){var n=c(e.components);return r.createElement(s.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},p=r.forwardRef((function(e,n){var a=e.components,t=e.mdxType,o=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=c(a),m=t,g=p["".concat(s,".").concat(m)]||p[m]||u[m]||o;return a?r.createElement(g,i(i({ref:n},d),{},{components:a})):r.createElement(g,i({ref:n},d))}));function m(e,n){var a=arguments,t=n&&n.mdxType;if("string"==typeof e||t){var o=a.length,i=new Array(o);i[0]=p;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:t,i[1]=l;for(var c=2;c<o;c++)i[c]=a[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,a)}p.displayName="MDXCreateElement"},1790:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var r=a(7462),t=(a(7294),a(3905));const o={sidebar_position:15},i="Instalaci\xf3n y configuraci\xf3n del servidor bind9 en nuestra red local",l={unversionedId:"Tasks/bind9_local",id:"Tasks/bind9_local",title:"Instalaci\xf3n y configuraci\xf3n del servidor bind9 en nuestra red local",description:"Procedimiento",source:"@site/docs/Tasks/bind9_local.md",sourceDirName:"Tasks",slug:"/Tasks/bind9_local",permalink:"/docs/Tasks/bind9_local",draft:!1,editUrl:"https://github.com/belennazareth/ottershell/blob/main/docs/Tasks/bind9_local.md",tags:[],version:"current",sidebarPosition:15,frontMatter:{sidebar_position:15},sidebar:"tutorialSidebar",previous:{title:"Configuraci\xf3n Apache2 + fpm+php",permalink:"/docs/Tasks/apache2_fpm"},next:{title:"Instalaci\xf3n de la aplicaci\xf3n BookMedik",permalink:"/docs/Tasks/bookmedik"}},s={},c=[{value:"Procedimiento",id:"procedimiento",level:2},{value:"Instalaci\xf3n y configuraci\xf3n del servidor bind9",id:"instalaci\xf3n-y-configuraci\xf3n-del-servidor-bind9",level:3},{value:"Modificaci\xf3n de la configuraci\xf3n",id:"modificaci\xf3n-de-la-configuraci\xf3n",level:2},{value:"Entrega",id:"entrega",level:2}],d={toc:c};function u(e){let{components:n,...a}=e;return(0,t.kt)("wrapper",(0,r.Z)({},d,a,{components:n,mdxType:"MDXLayout"}),(0,t.kt)("h1",{id:"instalaci\xf3n-y-configuraci\xf3n-del-servidor-bind9-en-nuestra-red-local"},"Instalaci\xf3n y configuraci\xf3n del servidor bind9 en nuestra red local"),(0,t.kt)("h2",{id:"procedimiento"},"Procedimiento"),(0,t.kt)("h3",{id:"instalaci\xf3n-y-configuraci\xf3n-del-servidor-bind9"},"Instalaci\xf3n y configuraci\xf3n del servidor bind9"),(0,t.kt)("p",null,"En primer lugar, creamos una m\xe1quina en proxmox y se configura con el usuario y contrase\xf1a, adem\xe1s de la clave ssh. En el fichero ",(0,t.kt)("inlineCode",{parentName:"p"},"/etc/hosts")," a\xf1adimos la siguiente l\xednea:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"127.0.1.1 dns1.nazareth.org dns1\n")),(0,t.kt)("p",null,"Y ejecutamos el siguiente comando para actualizar el nombre de la m\xe1quina:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"sudo hostnamectl set-hostname dns1\n")),(0,t.kt)("p",null,"Obteniendo como resultado:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"usuario@dns1:~$ hostname \ndns1\n\nusuario@dns1:~$ hostname -f\ndns1.nazareth.org\n")),(0,t.kt)("p",null,"Instalamos el servicio bind9 con el siguiente comando:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt install bind9\n")),(0,t.kt)("h2",{id:"modificaci\xf3n-de-la-configuraci\xf3n"},"Modificaci\xf3n de la configuraci\xf3n"),(0,t.kt)("p",null,"-"," Para que no se intente resolver usando ipv6, se debe modificar el fichero ",(0,t.kt)("inlineCode",{parentName:"p"},"/etc/default/named")," y a\xf1adir la siguiente l\xednea:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},'```bash\n  OPTIONS="-4 -f -u bind"\n```\n')),(0,t.kt)("p",null,"-"," Para que solo se permitan consultas desde la red local, se debe modificar el fichero ",(0,t.kt)("inlineCode",{parentName:"p"},"/etc/bind/named.conf.options")," y a\xf1adir la siguiente l\xednea:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"```bash\n  allow-query {172.29.0.0/16; 172.22.0.0/16;};\n```\n")),(0,t.kt)("p",null,"-"," Reiniciamos el servicio bind9 con el siguiente comando:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"```bash\nsudo systemctl restart bind9\n```\n")),(0,t.kt)("p",null,"-"," Hacemos un ",(0,t.kt)("inlineCode",{parentName:"p"},"dig")," para ver que funciona de tal manera que se solicita el nombre de dominio y se obtiene la direcci\xf3n ip de la m\xe1quina:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"```bash\nnazare@ThousandSunny :~$ dig @172.22.5.136  www.josedomingo.org\n\n; <<>> DiG 9.16.33-Debian <<>> @172.22.5.136 www.josedomingo.org\n; (1 server found)\n;; global options: +cmd\n;; Got answer:\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 22687\n;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n; COOKIE: a242d4befd4900d80100000063d8e90dae507b3eb8a6ebed (good)\n;; QUESTION SECTION:\n;www.josedomingo.org.       IN  A\n\n;; ANSWER SECTION:\nwww.josedomingo.org.    900 IN  CNAME   endor.josedomingo.org.\nendor.josedomingo.org.  900 IN  A   37.187.119.60\n\n;; Query time: 656 msec\n;; SERVER: 172.22.5.136#53(172.22.5.136)\n;; WHEN: Tue Jan 31 11:10:21 CET 2023\n;; MSG SIZE  rcvd: 112\n\n```\n")),(0,t.kt)("p",null,"-"," Para que el servidor resuelva los nombres de dominio de la red local, se debe modificar el fichero ",(0,t.kt)("inlineCode",{parentName:"p"},"/etc/bind/named.conf.local")," y a\xf1adir la siguiente l\xednea:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},'```bash\nzone "nazareth.org" {\n    type master;\n    file "db.nazareth.org";\n};\n```\n\nEsto har\xe1 que la informaci\xf3n de la zona se guarde en db.nazareth.org que est\xe1 en el directorio `/var/cache/bind`\n')),(0,t.kt)("p",null,"Lo siguiente ser\xe1 crear el fichero ",(0,t.kt)("inlineCode",{parentName:"p"},"db.nazareth.org")," en el directorio ",(0,t.kt)("inlineCode",{parentName:"p"},"/var/cache/bind")," y a\xf1adir la siguiente informaci\xf3n:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"$TTL    86400\n@       IN      SOA     dns1.nazareth.org. root.nazareth.org. (\n                              1         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                          86400 )       ; Negative Cache TTL\n;\n@   IN  NS      dns1.nazareth.org.\n@   IN  MX  10  correo.nazareth.org.\n\n$ORIGIN nazareth.org.\n\ndns1                IN  A   172.22.5.136 #IP de la m\xe1quina\ncorreo            IN    A   172.22.200.101\nasterix         IN  A   172.22.200.102\nobelix            IN    A   172.22.200.103\nwww               IN    CNAME   asterix\ninformatica     IN  CNAME   asterix\nftp               IN    CNAME   obelix\n")),(0,t.kt)("p",null,"-"," Crearemos una zona inversa para que el servidor resuelva los nombres de dominio de la red local, se debe modificar el fichero ",(0,t.kt)("inlineCode",{parentName:"p"},"/etc/bind/named.conf.local")," y a\xf1adir la siguiente l\xednea:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},'zone "22.172.in-addr.arpa" {\n    type master;\n    file "db.172.22.0.0";\n};\n')),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"Esto har\xe1 que la informaci\xf3n de la zona se guarde en db.172.22.0.0 que est\xe1 en el directorio `/var/cache/bind` \n")),(0,t.kt)("p",null,"Descomentamos la siguiente l\xednea en el fichero ",(0,t.kt)("inlineCode",{parentName:"p"},"/etc/bind/named.conf.local"),":"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},'include "/etc/bind/zones.rfc1918";\n')),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"De esta manera se incluir\xe1n todas las zonas que corresponden a las redes privadas, as\xed evitamos que se pregunte por ellas al servidor DNS ra\xedz.\n")),(0,t.kt)("p",null,"Entramos en ese mismo fichero y comentamos su definici\xf3n, ya que la hemos incluido en el fichero anterior:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},'...\n//zone "22.172.in-addr.arpa"  { type master; file "/etc/bind/db.empty"; };\n...\n')),(0,t.kt)("p",null,"-"," Creamos el fichero de zona inversa en el fichero ",(0,t.kt)("inlineCode",{parentName:"p"},"/var/cache/bind/db.172.22.0.0")," y a\xf1adimos la siguiente informaci\xf3n:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"$TTL    86400\n@       IN      SOA     dns1.nazareth.org. root.nazareth.org. (\n                              1         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                          86400 )       ; Negative Cache TTL\n;\n@   IN  NS      dns1.nazareth.org.\n\n$ORIGIN 22.172.in-addr.arpa.\n\n136.5           IN  PTR     dns1.nazareth.org.\n101.200     IN  PTR     correo.nazareth.org.\n102.200     IN  PTR     asterix.nazareth.org.\n103.200     IN  PTR     obelix.nazareth.org.\n")),(0,t.kt)("p",null,"-"," Reiniciamos el servicio bind9 con el siguiente comando:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl restart bind9\n")),(0,t.kt)("p",null,"-"," En otra m\xe1quina configuramos el DNS en el fichero ",(0,t.kt)("inlineCode",{parentName:"p"},"/etc/resolv.conf"),":"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"nameserver 172.22.5.136\n")),(0,t.kt)("p",null,"Y ejecutamos el comando ",(0,t.kt)("inlineCode",{parentName:"p"},"dig")," para comprobar que funciona correctamente:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"dig www.nazareth.org\n")),(0,t.kt)("h2",{id:"entrega"},"Entrega"))}u.isMDXComponent=!0}}]);