"use strict";(self.webpackChunkotter_shell=self.webpackChunkotter_shell||[]).push([[1915],{3905:(e,a,r)=>{r.d(a,{Zo:()=>p,kt:()=>u});var n=r(7294);function t(e,a,r){return a in e?Object.defineProperty(e,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[a]=r,e}function o(e,a){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var a=1;a<arguments.length;a++){var r=null!=arguments[a]?arguments[a]:{};a%2?o(Object(r),!0).forEach((function(a){t(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}function c(e,a){if(null==e)return{};var r,n,t=function(e,a){if(null==e)return{};var r,n,t={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],a.indexOf(r)>=0||(t[r]=e[r]);return t}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],a.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(t[r]=e[r])}return t}var i=n.createContext({}),s=function(e){var a=n.useContext(i),r=a;return e&&(r="function"==typeof e?e(a):l(l({},a),e)),r},p=function(e){var a=s(e.components);return n.createElement(i.Provider,{value:a},e.children)},d={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},m=n.forwardRef((function(e,a){var r=e.components,t=e.mdxType,o=e.originalType,i=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),m=s(r),u=t,h=m["".concat(i,".").concat(u)]||m[u]||d[u]||o;return r?n.createElement(h,l(l({ref:a},p),{},{components:r})):n.createElement(h,l({ref:a},p))}));function u(e,a){var r=arguments,t=a&&a.mdxType;if("string"==typeof e||t){var o=r.length,l=new Array(o);l[0]=m;var c={};for(var i in a)hasOwnProperty.call(a,i)&&(c[i]=a[i]);c.originalType=e,c.mdxType="string"==typeof e?e:t,l[1]=c;for(var s=2;s<o;s++)l[s]=r[s];return n.createElement.apply(null,l)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},9236:(e,a,r)=>{r.r(a),r.d(a,{assets:()=>i,contentTitle:()=>l,default:()=>d,frontMatter:()=>o,metadata:()=>c,toc:()=>s});var n=r(7462),t=(r(7294),r(3905));const o={sidebar_position:29},l="Configuraci\xf3n de un servidor Apache2",c={unversionedId:"Tasks/configuracion_apache2",id:"Tasks/configuracion_apache2",title:"Configuraci\xf3n de un servidor Apache2",description:"Procedimiento",source:"@site/docs/Tasks/configuracion_apache2.md",sourceDirName:"Tasks",slug:"/Tasks/configuracion_apache2",permalink:"/docs/Tasks/configuracion_apache2",draft:!1,editUrl:"https://github.com/belennazareth/ottershell/blob/main/docs/Tasks/configuracion_apache2.md",tags:[],version:"current",sidebarPosition:29,frontMatter:{sidebar_position:29},sidebar:"tutorialSidebar",previous:{title:"Delegaci\xf3n de subdominios con bind9",permalink:"/docs/Tasks/bind9_subdominios"},next:{title:"Instalaci\xf3n y configuraci\xf3n del servidor DHCP",permalink:"/docs/Tasks/configuracion_dhcp"}},i={},s=[{value:"Procedimiento",id:"procedimiento",level:2},{value:"Entrega",id:"entrega",level:2},{value:"1. Configuraci\xf3n completa del virtualhost.",id:"1-configuraci\xf3n-completa-del-virtualhost",level:3},{value:"2. Comprobaci\xf3n de que al acceder a www.taller2.com se produce una redirecci\xf3n.",id:"2-comprobaci\xf3n-de-que-al-acceder-a-wwwtaller2com-se-produce-una-redirecci\xf3n",level:3},{value:"3. Pantallazo accediendo a www.taller2.com/principal/documentos (pon algunos ficheros para que se vea la lista).",id:"3-pantallazo-accediendo-a-wwwtaller2comprincipaldocumentos-pon-algunos-ficheros-para-que-se-vea-la-lista",level:3},{value:"4. Pantallazos de accesos a www.taller2.com/intranet desde el host y el clientee interno. Pantallazos de acceso a www.taller2.com/internet desde el host y el clientee interno.",id:"4-pantallazos-de-accesos-a-wwwtaller2comintranet-desde-el-host-y-el-clientee-interno-pantallazos-de-acceso-a-wwwtaller2cominternet-desde-el-host-y-el-clientee-interno",level:3},{value:"5. Pantallazos de la autentificaci\xf3n b\xe1sica.",id:"5-pantallazos-de-la-autentificaci\xf3n-b\xe1sica",level:3},{value:"6. Pantallazos de acceso a www.taller2.com/secreto desde el host y el clientee interno.",id:"6-pantallazos-de-acceso-a-wwwtaller2comsecreto-desde-el-host-y-el-clientee-interno",level:3},{value:"7. Contenido del fichero .htaccess. Acceso a www.taller2.com/documentos comprobando que se produce una redirecci\xf3n desde el exterior y prueba de acceso desde el clientee interno para comprobar que no tiene permiso de acceso.",id:"7-contenido-del-fichero-htaccess-acceso-a-wwwtaller2comdocumentos-comprobando-que-se-produce-una-redirecci\xf3n-desde-el-exterior-y-prueba-de-acceso-desde-el-clientee-interno-para-comprobar-que-no-tiene-permiso-de-acceso",level:3}],p={toc:s};function d(e){let{components:a,...r}=e;return(0,t.kt)("wrapper",(0,n.Z)({},p,r,{components:a,mdxType:"MDXLayout"}),(0,t.kt)("h1",{id:"configuraci\xf3n-de-un-servidor-apache2"},"Configuraci\xf3n de un servidor Apache2"),(0,t.kt)("h2",{id:"procedimiento"},"Procedimiento"),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"Para hacer este ejercicio, crea un escenario en Vagrant, que tenga una m\xe1quina (servidorweb) conectada a una red \u201cexterna\u201d (que podamos acceder desde nuestro host, puede ser una red p\xfablica o una red privada NAT), y una privada (aislada o muy aislada) y un clientee conectada a esta nueva red.")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-yaml"},'Vagrant.configure("2") do |config|\n    config.vm.box = "debian/bullseye64"\n    config.vm.synced_folder ".", "/vagrant", disabled: true\n\n    config.vm.define :servidorweb do |servidorweb|\n        servidorweb.vm.hostname = "servidorweb"\n        servidorweb.vm.network :public_network,\n        :dev => "br0",\n        :mode => "bridge",\n        :type => "bridge"\n        servidorweb.vm.network :private_network,\n        :libvirt__network_name => "redaislada",\n        :libvirt__dhcp_enabled => false,\n        :ip => "10.0.0.1",\n       :libvirt__forward_mode => "veryisolated"\n    end\n    config.vm.define :cliente do |cliente|\n        cliente.vm.hostname = "cliente"\n        cliente.vm.network :private_network,\n        :libvirt__network_name => "redaislada",\n        :libvirt__dhcp_enabled => false,\n        :ip => "10.0.0.2",\n        :libvirt__forward_mode => "veryisolated"\n    end\nend\n')),(0,t.kt)("p",null,"*Nota: ser\xe1 necesario crear un bridge br0 en ",(0,t.kt)("inlineCode",{parentName:"p"},"/etc/network/interfaces"),", despu\xe9s se ejecuta ",(0,t.kt)("inlineCode",{parentName:"p"},"ifup br0")," para activarlo (si eso hacer ",(0,t.kt)("inlineCode",{parentName:"p"},"ifup eno1")," para porsiaca). El fichero ",(0,t.kt)("inlineCode",{parentName:"p"},"/etc/network/interfaces")," quedar\xeda as\xed:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-yaml"},"auto eno1\niface eno1 inet dhcp\n\nauto br0\niface br0 inet dhcp\n    bridge_ports eno1\n")),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"1. Instala un servidor web apache2 en servidorweb.")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt update\nsudo apt install apache2\n")),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"2. Crea un virtualhost con el que accederemos con el nombre ",(0,t.kt)("a",{parentName:"strong",href:"http://www.taller2.com."},"www.taller2.com.")," En este virtualhost realizaremos los siguientes ejercicios.")),(0,t.kt)("p",null,"Para crearlo editamos el fichero ",(0,t.kt)("inlineCode",{parentName:"p"},"/etc/apache2/sites-available/taller2.conf")," y le ponemos el siguiente contenido:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-yaml"},"<VirtualHost *:80>\n\n    ServerName www.taller2.com\n    DocumentRoot /home/vagrant/taller2\n\n    <Directory /home/vagrant/taller2>\n        Require all granted\n    </Directory>\n\n    ErrorLog ${APACHE_LOG_DIR}/taller2_error.log\n    CustomLog ${APACHE_LOG_DIR}/taller2_access.log combined\n\n</VirtualHost>\n")),(0,t.kt)("p",null,"Creamos el directorio ",(0,t.kt)("inlineCode",{parentName:"p"},"/home/vagrant/taller2"),":"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir /home/vagrant/taller2\n")),(0,t.kt)("p",null,"Cambiamos el propietario del directorio:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"chown -R vagrant:vagrant /home/vagrant/taller2\n")),(0,t.kt)("p",null,"Cambiamos los permisos del directorio:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"chmod -R 755 /home/vagrant/taller2\n")),(0,t.kt)("p",null,"Activamos el virtualhost:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"sudo a2ensite taller2.conf\n")),(0,t.kt)("p",null,"Reiniciamos el servicio:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl restart apache2\n")),(0,t.kt)("p",null,"Editamos el fichero ",(0,t.kt)("inlineCode",{parentName:"p"},"/etc/hosts")," y a\xf1adimos la siguiente l\xednea:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"{ip_servidor}    www.taller2.com\n")),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"3. Cuando se entre a la direcci\xf3n ",(0,t.kt)("a",{parentName:"strong",href:"http://www.taller2.com"},"www.taller2.com")," se redireccionar\xe1 autom\xe1ticamente a ",(0,t.kt)("a",{parentName:"strong",href:"http://www.taller2.com/principal"},"www.taller2.com/principal"),", donde se mostrar\xe1 el mensaje de bienvenida.")),(0,t.kt)("p",null,"Hacemos el directorio principal:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir /home/vagrant/taller2/principal\n")),(0,t.kt)("p",null,"Creamos el fichero ",(0,t.kt)("inlineCode",{parentName:"p"},"index.html"),":"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},'echo "<h1>Bienvenido a la pagina principal :)</h1>" > /home/vagrant/taller2/principal/index.html\n')),(0,t.kt)("p",null,"Hacemos que el directorio principal sea el directorio por defecto:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"<VirtualHost *:80>\n\n    ServerName www.taller2.com\n    DocumentRoot /home/vagrant/taller2\n\n    RedirectMatch ^/$ /principal\n\n    <Directory /home/vagrant/taller2>\n        Require all granted\n    </Directory>\n\n    <Directory /home/vagrant/taller2/principal>\n        Require all granted\n    </Directory>\n\n    ErrorLog ${APACHE_LOG_DIR}/taller2_error.log\n    CustomLog ${APACHE_LOG_DIR}/taller2_access.log combined\n\n</VirtualHost>\n")),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"4. Si accedes a la p\xe1gina ",(0,t.kt)("a",{parentName:"strong",href:"http://www.taller2.com/principal/documentos"},"www.taller2.com/principal/documentos")," se visualizar\xe1n los documentos que hay en home/usuario/doc. Por lo tanto se permitir\xe1 el listado de ficheros (opci\xf3n Indexes).")),(0,t.kt)("p",null,"Creamos el directorio para visualizar los documentos:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir /home/vagrant/doc\n")),(0,t.kt)("p",null,"Creamos algunos ficheros:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},'echo "Fichero1" > /home/vagrant/doc/fichero1.txt\necho "Fichero2" > /home/vagrant/doc/fichero2.txt\necho "Fichero 3" > /home/vagrant/doc/fichero3.txt\n')),(0,t.kt)("p",null,"Modificamos:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"<VirtualHost *:80>\n\n    ServerName www.taller2.com\n    DocumentRoot /home/vagrant/taller2\n\n    RedirectMatch ^/$ /principal\n\n    Alias /principal/documentos /home/vagrant/doc\n\n    <Directory /home/vagrant/taller2>\n        Require all granted\n    </Directory>\n\n    <Directory /home/vagrant/taller2/principal>\n        Require all granted\n    </Directory>\n\n    <Directory /home/vagrant/doc>\n        Options Indexes\n        Require all granted\n    </Directory>\n\n    ErrorLog ${APACHE_LOG_DIR}/taller2_error.log\n    CustomLog ${APACHE_LOG_DIR}/taller2_access.log combined\n\n</VirtualHost>\n")),(0,t.kt)("p",null,"*Nota: El redirectmacth se hace cuando es una redireccion dentro documentroot, mientras que el alias es cuando es una redireccion fuera del documentroot."),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"5. A la URL ",(0,t.kt)("a",{parentName:"strong",href:"http://www.taller2.com/intranet"},"www.taller2.com/intranet")," s\xf3lo se debe tener acceso desde el cliente de la red interna, y no se pueda acceder desde la anfitriona por la red p\xfablica. A la URL ",(0,t.kt)("a",{parentName:"strong",href:"http://www.taller2.com/internet"},"www.taller2.com/internet"),", sin embargo, s\xf3lo se debe tener acceso desde la anfitriona por la red p\xfablica, y no desde la red interna.")),(0,t.kt)("p",null,"Para esto hay que cambiar el fichero ",(0,t.kt)("inlineCode",{parentName:"p"},"/etc/apache2/sites-available/taller2.conf"),":"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-yaml"},"<VirtualHost *:80>\n\n    ServerName www.taller2.com\n    DocumentRoot /home/vagrant/taller2\n\n    RedirectMatch ^/$ /principal\n\n    Alias /principal/documentos /home/vagrant/doc\n\n    <Directory /home/vagrant/taller2>\n        Require all granted\n    </Directory>\n\n    <Directory /home/vagrant/taller2/principal>\n        Require all granted\n    </Directory>\n\n    <Directory /home/vagrant/doc>\n        Options Indexes\n        Require all granted\n    </Directory>\n\n    <Directory /home/vagrant/taller2/intranet>\n        Require ip 10.0.0.0/24\n    </Directory>\n\n    <Directory /home/vagrant/taller2/internet>\n        Require ip 192.168.1.0/24\n    </Directory>\n\n    ErrorLog ${APACHE_LOG_DIR}/taller2_error.log\n    CustomLog ${APACHE_LOG_DIR}/taller2_access.log combined\n\n</VirtualHost>\n")),(0,t.kt)("p",null,"Creamos unos ficheros para probar:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},'mkdir /home/vagrant/taller2/intranet\nmkdir /home/vagrant/taller2/internet\necho "<h1>Welcome a Intranet</h1>" > /home/vagrant/taller2/intranet/index.html\necho "<h1>Welcome a Internet</h1>" > /home/vagrant/taller2/internet/index.html\n')),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"6. Autentificaci\xf3n b\xe1sica. Limita el acceso a la URL ",(0,t.kt)("a",{parentName:"strong",href:"http://www.taller2.com/secreto"},"www.taller2.com/secreto"),".")),(0,t.kt)("p",null,"Creamos el directorio:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir /home/vagrant/taller2/secreto\n")),(0,t.kt)("p",null,"Creamos el fichero ",(0,t.kt)("inlineCode",{parentName:"p"},"index.html"),":"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},'echo "<h1>Acceso restringido</h1>" > /home/vagrant/taller2/secreto/index.html\n')),(0,t.kt)("p",null,"Creamos el directorio para las claves:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir /etc/apache2/claves\n")),(0,t.kt)("p",null,"Creamos el fichero de contrase\xf1as:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"htpasswd -c /etc/apache2/claves/contra.txt usuario\n")),(0,t.kt)("p",null,"Modificamos el fichero ",(0,t.kt)("inlineCode",{parentName:"p"},"/etc/apache2/sites-available/taller2.conf"),":"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-yaml"},'<VirtualHost *:80>\n\n    ServerName www.taller2.com\n    DocumentRoot /home/vagrant/taller2\n\n    RedirectMatch ^/$ /principal\n\n    Alias /principal/documentos /home/vagrant/doc\n\n    <Directory /home/vagrant/taller2>\n        Require all granted\n    </Directory>\n\n    <Directory /home/vagrant/taller2/principal>\n        Require all granted\n    </Directory>\n\n    <Directory /home/vagrant/doc>\n        Options Indexes\n        Require all granted\n    </Directory>\n\n    <Directory /home/vagrant/taller2/intranet>\n        Require ip 10.0.0.0/24\n    </Directory>\n\n    <Directory /home/vagrant/taller2/internet>\n        Require ip 192.168.1.0/24\n    </Directory>\n\n    <Directory /home/vagrant/taller2/secreto>\n        AuthType Basic\n        AuthName "Acceso restringido"\n        AuthUserFile /etc/apache2/claves/contra.txt\n        Require valid-user\n    </Directory>\n\n    ErrorLog ${APACHE_LOG_DIR}/taller2_error.log\n    CustomLog ${APACHE_LOG_DIR}/taller2_access.log combined\n\n</VirtualHost>\n')),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"7. Vamos a combinar el control de acceso (ejercicio 5) y la autentificaci\xf3n (ejercicio 6), y vamos a configurar el virtual host para que se comporte de la siguiente manera: el acceso a la URL ",(0,t.kt)("a",{parentName:"strong",href:"http://www.taller2.com/secreto"},"www.taller2.com/secreto")," se hace forma directa desde la intranet, desde la red p\xfablica te pide la autentificaci\xf3n.")),(0,t.kt)("p",null,"Modificamos el fichero ",(0,t.kt)("inlineCode",{parentName:"p"},"/etc/apache2/sites-available/taller2.conf"),":"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-yaml"},'<VirtualHost *:80>\n\n    ServerName www.taller2.com\n    DocumentRoot /home/vagrant/taller2\n\n    RedirectMatch ^/$ /principal\n\n    Alias /principal/documentos /home/vagrant/doc\n\n    <Directory /home/vagrant/taller2>\n        Require all granted\n    </Directory>\n\n    <Directory /home/vagrant/taller2/principal>\n        Require all granted\n    </Directory>\n\n    <Directory /home/vagrant/doc>\n        Options Indexes\n        Require all granted\n    </Directory>\n\n    <Directory /home/vagrant/taller2/intranet>\n        Require ip 10.0.0.0/24\n    </Directory>\n\n    <Directory /home/vagrant/taller2/internet>\n        Require ip 192.168.1.0/24\n    </Directory>\n\n    <Directory /home/vagrant/taller2/secreto>\n        AuthType Basic\n        AuthName "Acceso restringido"\n        AuthUserFile /etc/apache2/claves/contra.txt\n        Require valid-user\n        Require ip 10.0.0.0/24\n    </Directory>\n\n    ErrorLog ${APACHE_LOG_DIR}/taller2_error.log\n    CustomLog ${APACHE_LOG_DIR}/taller2_access.log combined\n\n</VirtualHost>\n')),(0,t.kt)("p",null,"En el cliente editamos el fichero ",(0,t.kt)("inlineCode",{parentName:"p"},"/etc/hosts"),":"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"10.0.0.1 www.taller2.com\n")),(0,t.kt)("p",null,"Para probarlo, desde la red interna:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"curl http://www.taller2.com/secreto/\n")),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"8. El m\xf3dulo rewrite nos va a permitir acceder a una URL e internamente estar accediendo a otra. Esto nos puede ayudar a hacer URL amigables y hacer redirecciones. Por ejemplo para redireccionar a otra URL:")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-yaml"},"RewriteEngine On\nRewriteRule ^(.*)$ http://www.nueva.com/$1 [R=301,L]\n")),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"Usando un fichero .htaccess haz que al acceder a la URL ",(0,t.kt)("a",{parentName:"strong",href:"http://www.taller2.com/documentos"},"www.taller2.com/documentos")," se produce una redirecci\xf3n a ",(0,t.kt)("a",{parentName:"strong",href:"http://www.taller2.com/principal/documentos"},"www.taller2.com/principal/documentos")," usando el modulo rewrite (recuerda que tienes que activarlo). Adem\xe1s, deniega el acceso desde la red interna.")),(0,t.kt)("p",null,"Activamos el m\xf3dulo rewrite:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"a2enmod rewrite\n")),(0,t.kt)("p",null,"Creamos el directorio:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir /home/vagrant/taller2/documentos\n")),(0,t.kt)("p",null,"Creamos el fichero ",(0,t.kt)("inlineCode",{parentName:"p"},".htaccess"),":"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},'echo "RewriteEngine On" > /home/vagrant/taller2/documentos/.htaccess\necho "RewriteRule ^(.*)$ /principal/documentos/$1 [R=301,L]" >> /home/vagrant/taller2/documentos/.htaccess\n')),(0,t.kt)("p",null,"Modificamos el fichero ",(0,t.kt)("inlineCode",{parentName:"p"},"/etc/apache2/sites-available/taller2.conf"),":"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-yaml"},'<VirtualHost *:80>\n\n    ServerName www.taller2.com\n    DocumentRoot /home/vagrant/taller2\n\n    RedirectMatch ^/$ /principal\n\n    Alias /principal/documentos /home/vagrant/doc\n\n    <Directory /home/vagrant/taller2>\n        Require all granted\n    </Directory>\n\n    <Directory /home/vagrant/taller2/principal>\n        Require all granted\n    </Directory>\n\n    <Directory /home/vagrant/doc>\n        Options Indexes\n        Require all granted\n    </Directory>\n\n    <Directory /home/vagrant/taller2/intranet>\n        Require ip 10.0.0.0/24\n    </Directory>\n\n    <Directory /home/vagrant/taller2/internet>\n        Require ip 192.168.1.0/24\n    </Directory>\n\n    <Directory /home/vagrant/taller2/secreto>\n        AuthType Basic\n        AuthName "Acceso restringido"\n        AuthUserFile /etc/apache2/claves/contra.txt\n        Require valid-user\n        Require ip 10.0.0.0/24\n    </Directory>\n\n    <Directory /home/vagrant/taller2/documentos>\n        Require all granted\n    </Directory>\n\n    ErrorLog ${APACHE_LOG_DIR}/taller2_error.log\n    CustomLog ${APACHE_LOG_DIR}/taller2_access.log combined\n\n</VirtualHost>\n')),(0,t.kt)("p",null,"Y reiniciamos el servicio:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"systemctl restart apache2\n")),(0,t.kt)("h2",{id:"entrega"},"Entrega"),(0,t.kt)("h3",{id:"1-configuraci\xf3n-completa-del-virtualhost"},"1. Configuraci\xf3n completa del virtualhost."),(0,t.kt)("h3",{id:"2-comprobaci\xf3n-de-que-al-acceder-a-wwwtaller2com-se-produce-una-redirecci\xf3n"},"2. Comprobaci\xf3n de que al acceder a ",(0,t.kt)("a",{parentName:"h3",href:"http://www.taller2.com"},"www.taller2.com")," se produce una redirecci\xf3n."),(0,t.kt)("h3",{id:"3-pantallazo-accediendo-a-wwwtaller2comprincipaldocumentos-pon-algunos-ficheros-para-que-se-vea-la-lista"},"3. Pantallazo accediendo a ",(0,t.kt)("a",{parentName:"h3",href:"http://www.taller2.com/principal/documentos"},"www.taller2.com/principal/documentos")," (pon algunos ficheros para que se vea la lista)."),(0,t.kt)("h3",{id:"4-pantallazos-de-accesos-a-wwwtaller2comintranet-desde-el-host-y-el-clientee-interno-pantallazos-de-acceso-a-wwwtaller2cominternet-desde-el-host-y-el-clientee-interno"},"4. Pantallazos de accesos a ",(0,t.kt)("a",{parentName:"h3",href:"http://www.taller2.com/intranet"},"www.taller2.com/intranet")," desde el host y el clientee interno. Pantallazos de acceso a ",(0,t.kt)("a",{parentName:"h3",href:"http://www.taller2.com/internet"},"www.taller2.com/internet")," desde el host y el clientee interno."),(0,t.kt)("h3",{id:"5-pantallazos-de-la-autentificaci\xf3n-b\xe1sica"},"5. Pantallazos de la autentificaci\xf3n b\xe1sica."),(0,t.kt)("h3",{id:"6-pantallazos-de-acceso-a-wwwtaller2comsecreto-desde-el-host-y-el-clientee-interno"},"6. Pantallazos de acceso a ",(0,t.kt)("a",{parentName:"h3",href:"http://www.taller2.com/secreto"},"www.taller2.com/secreto")," desde el host y el clientee interno."),(0,t.kt)("h3",{id:"7-contenido-del-fichero-htaccess-acceso-a-wwwtaller2comdocumentos-comprobando-que-se-produce-una-redirecci\xf3n-desde-el-exterior-y-prueba-de-acceso-desde-el-clientee-interno-para-comprobar-que-no-tiene-permiso-de-acceso"},"7. Contenido del fichero .htaccess. Acceso a ",(0,t.kt)("a",{parentName:"h3",href:"http://www.taller2.com/documentos"},"www.taller2.com/documentos")," comprobando que se produce una redirecci\xf3n desde el exterior y prueba de acceso desde el clientee interno para comprobar que no tiene permiso de acceso."))}d.isMDXComponent=!0}}]);