"use strict";(self.webpackChunkotter_shell=self.webpackChunkotter_shell||[]).push([[4271],{3905:(e,a,r)=>{r.d(a,{Zo:()=>u,kt:()=>g});var o=r(67294);function t(e,a,r){return a in e?Object.defineProperty(e,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[a]=r,e}function n(e,a){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);a&&(o=o.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),r.push.apply(r,o)}return r}function l(e){for(var a=1;a<arguments.length;a++){var r=null!=arguments[a]?arguments[a]:{};a%2?n(Object(r),!0).forEach((function(a){t(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}function i(e,a){if(null==e)return{};var r,o,t=function(e,a){if(null==e)return{};var r,o,t={},n=Object.keys(e);for(o=0;o<n.length;o++)r=n[o],a.indexOf(r)>=0||(t[r]=e[r]);return t}(e,a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(o=0;o<n.length;o++)r=n[o],a.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(t[r]=e[r])}return t}var s=o.createContext({}),c=function(e){var a=o.useContext(s),r=a;return e&&(r="function"==typeof e?e(a):l(l({},a),e)),r},u=function(e){var a=c(e.components);return o.createElement(s.Provider,{value:a},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var a=e.children;return o.createElement(o.Fragment,{},a)}},m=o.forwardRef((function(e,a){var r=e.components,t=e.mdxType,n=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),d=c(r),m=t,g=d["".concat(s,".").concat(m)]||d[m]||p[m]||n;return r?o.createElement(g,l(l({ref:a},u),{},{components:r})):o.createElement(g,l({ref:a},u))}));function g(e,a){var r=arguments,t=a&&a.mdxType;if("string"==typeof e||t){var n=r.length,l=new Array(n);l[0]=m;var i={};for(var s in a)hasOwnProperty.call(a,s)&&(i[s]=a[s]);i.originalType=e,i[d]="string"==typeof e?e:t,l[1]=i;for(var c=2;c<n;c++)l[c]=r[c];return o.createElement.apply(null,l)}return o.createElement.apply(null,r)}m.displayName="MDXCreateElement"},12082:(e,a,r)=>{r.r(a),r.d(a,{assets:()=>s,contentTitle:()=>l,default:()=>p,frontMatter:()=>n,metadata:()=>i,toc:()=>c});var o=r(87462),t=(r(67294),r(3905));const n={sidebar_position:21},l="Servidor de correos",i={unversionedId:"Tasks/correo_vps",id:"Tasks/correo_vps",title:"Servidor de correos",description:"Instala y configura de manera adecuada el servidor de correos en tu VPS. El nombre del servidor de correo ser\xe1 mail.tudominio.es (este es el nombre que deber\xe1 aparecer en el registro MX).",source:"@site/docs/Tasks/correo_vps.md",sourceDirName:"Tasks",slug:"/Tasks/correo_vps",permalink:"/docs/Tasks/correo_vps",draft:!1,editUrl:"https://github.com/belennazareth/ottershell/blob/main/docs/Tasks/correo_vps.md",tags:[],version:"current",sidebarPosition:21,frontMatter:{sidebar_position:21},sidebar:"tutorialSidebar",previous:{title:"Recolecci\xf3n centralizada de logs del sistema",permalink:"/docs/Tasks/journald"},next:{title:"Despliegue de aplicaciones Java",permalink:"/docs/Tasks/despliegue_java"}},s={},c=[{value:"Gesti\xf3n de correos desde el servidor",id:"gesti\xf3n-de-correos-desde-el-servidor",level:2},{value:"Uso de alias y redirecciones",id:"uso-de-alias-y-redirecciones",level:2},{value:"Para asegurar el env\xedo",id:"para-asegurar-el-env\xedo",level:2},{value:"Para luchar contra el SPAM",id:"para-luchar-contra-el-spam",level:2},{value:"Gesti\xf3n de correos desde un cliente",id:"gesti\xf3n-de-correos-desde-un-cliente",level:2},{value:"Comprobaci\xf3n final",id:"comprobaci\xf3n-final",level:2}],u={toc:c},d="wrapper";function p(e){let{components:a,...n}=e;return(0,t.kt)(d,(0,o.Z)({},u,n,{components:a,mdxType:"MDXLayout"}),(0,t.kt)("h1",{id:"servidor-de-correos"},"Servidor de correos"),(0,t.kt)("p",null,"Instala y configura de manera adecuada el servidor de correos en tu VPS. El nombre del servidor de correo ser\xe1 mail.tudominio.es (este es el nombre que deber\xe1 aparecer en el registro MX)."),(0,t.kt)("h2",{id:"gesti\xf3n-de-correos-desde-el-servidor"},"Gesti\xf3n de correos desde el servidor"),(0,t.kt)("p",null,"El env\xedo y recepci\xf3n se har\xe1 desde el servidor usando la herramienta mail."),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"Tarea 1:")," Documenta una prueba de funcionamiento, donde env\xedes desde tu servidor local al exterior. Muestra el log donde se vea el env\xedo. Muestra el correo que has recibido. Muestra el registro SPF.")),(0,t.kt)("hr",null),(0,t.kt)("p",null,"Instalamos postfix en la VPS:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ sudo apt install postfix\n")),(0,t.kt)("p",null,"Y bsd-mailx para poder enviar correos desde la VPS:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ sudo apt install bsd-mailx\n")),(0,t.kt)("p",null,"En la VPS a\xf1ado un registro MX para que apunte a mail.ottershell.es. Compruebo que el registro MX est\xe1 bien configurado:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ dig MX ottershell.es\n")),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Postfix",src:r(31941).Z,width:"729",height:"533"})),(0,t.kt)("p",null,"A\xf1ado el puerto 25 al firewall de la VPS.\nY el DNS inverso a ",(0,t.kt)("inlineCode",{parentName:"p"},"buizel.ottershell.es")),(0,t.kt)("p",null,"Aqu\xed se puede ver el el mensaje que se ha enviado desde la VPS a mi correo personal y los logs de mail:"),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Postfix",src:r(56095).Z,width:"533",height:"345"}),"\n",(0,t.kt)("img",{alt:"Postfix",src:r(74373).Z,width:"1908",height:"429"})),(0,t.kt)("p",null,"Obtenemos de registro SPF:"),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Postfix",src:r(26934).Z,width:"1556",height:"970"})),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"Tarea 2:")," Documenta una prueba de funcionamiento, donde env\xedes un correo desde el exterior (gmail, hotmail,\u2026) a tu servidor local. Muestra el log donde se vea el env\xedo. Muestra c\xf3mo has le\xeddo el correo. Muestra el registro MX de tu dominio.")),(0,t.kt)("hr",null),(0,t.kt)("p",null,"Para esto voy a responder al correo recibido en la tarea anterior desde mi correo personal a la VPS:"),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Postfix",src:r(84494).Z,width:"616",height:"506"})),(0,t.kt)("p",null,"Para leer el correo desde la VPS:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ mail\n")),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Postfix",src:r(49688).Z,width:"700",height:"123"}),"\n",(0,t.kt)("img",{alt:"Postfix",src:r(88759).Z,width:"809",height:"1017"})),(0,t.kt)("p",null,"Aqu\xed vemos el log de mail:"),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Postfix",src:r(51496).Z,width:"1908",height:"352"})),(0,t.kt)("p",null,"En el ejercicio anterior se explica el registro MX de mi dominio, como se puede ver en la imagen siguiente al hacer un dig MX a mi dominio:"),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Postfix",src:r(38050).Z,width:"781",height:"639"})),(0,t.kt)("h2",{id:"uso-de-alias-y-redirecciones"},"Uso de alias y redirecciones"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"Tarea 3:")," Uso de alias y redirecciones.")),(0,t.kt)("p",null,"Vamos a comprobar como los procesos del servidor pueden mandar correos para informar sobre su estado. Por ejemplo cada vez que se ejecuta una tarea cron podemos enviar un correo informando del resultado. Normalmente estos correos se mandan al usuario ",(0,t.kt)("inlineCode",{parentName:"p"},"root")," del servidor, para ello:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ crontab -e\n")),(0,t.kt)("p",null,"E indico donde se env\xeda el correo:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"MAILTO = root\n")),(0,t.kt)("p",null,"Puedes poner alguna tarea en el cron para ver como se mandan correo."),(0,t.kt)("p",null,"Posteriormente usando alias y redirecciones podemos hacer llegar esos correos a nuestro correo personal."),(0,t.kt)("p",null,"Configura el cron para enviar correo al usuario ",(0,t.kt)("inlineCode",{parentName:"p"},"root"),". Comprueba que est\xe1n llegando esos correos al root. Crea un nuevo alias para que se manden a un usuario sin privilegios. Comprueban que llegan a ese usuario. Por \xfaltimo crea una redirecci\xf3n para enviar esos correo a tu correo personal (gmail,hotmail,\u2026)."),(0,t.kt)("h2",{id:"para-asegurar-el-env\xedo"},"Para asegurar el env\xedo"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"Tarea 4 (No obligatoria):")," Configura de manera adecuada DKIM es tu sistema de correos. Comprueba el registro DKIM en la p\xe1gina ",(0,t.kt)("a",{parentName:"li",href:"https://mxtoolbox.com/dkim.aspx"},"https://mxtoolbox.com/dkim.aspx"),". Configura postfix para que firme los correos que env\xeda. Manda un correo y comprueba la verificaci\xf3n de las firmas en ellos.")),(0,t.kt)("h2",{id:"para-luchar-contra-el-spam"},"Para luchar contra el SPAM"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("strong",{parentName:"p"},"Tarea 5 (No obligatorio):")," Configura de manera adecuada Postfix para que tenga en cuenta el registro SPF de los correos que recibe. Muestra el log del correo para comprobar que se est\xe1 haciendo el testeo del registro SPF.")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("strong",{parentName:"p"},"Tarea 6 (No obligatoria):")," Configura un sistema antispam. Realiza comprobaciones para comprobarlo.")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("strong",{parentName:"p"},"Tarea 7 (No obligatoria):")," Configura un sistema antivirus. Realiza comprobaciones para comprobarlo."))),(0,t.kt)("h2",{id:"gesti\xf3n-de-correos-desde-un-cliente"},"Gesti\xf3n de correos desde un cliente"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("strong",{parentName:"p"},"Tarea 8:")," Configura el buz\xf3n de los usuarios de tipo Maildir. Env\xeda un correo a tu usuario y comprueba que el correo se ha guardado en el buz\xf3n Maildir del usuario del sistema correspondiente. Recuerda que ese tipo de buz\xf3n no se puede leer con la utilidad mail.")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("strong",{parentName:"p"},"Tarea 9:")," Instala configura dovecot para ofrecer el protocolo IMAP. Configura dovecot de manera adecuada para ofrecer autentificaci\xf3n y cifrado."))),(0,t.kt)("p",null,"Para realizar el cifrado de la comunicaci\xf3n crea un certificado en LetsEncrypt para tu dominio mail.tudominio.es. Recuerda que para el ofrecer el cifrado tiene varias soluciones:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"IMAP con STARTTLS: STARTTLS transforma una conexi\xf3n insegura en una segura mediante el uso de SSL/TLS. Por lo tanto usando el mismo puerto 143/tcp tenemos cifrada la comunicaci\xf3n.")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"IMAPS: Versi\xf3n segura del protocolo IMAP que usa el puerto 993/tcp.")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"Ofrecer las dos posibilidades."))),(0,t.kt)("p",null,"Elige una de las opciones anterior para realizar el cifrado. Y muestra la configuraci\xf3n de un cliente de correo (evolution, thunderbird, \u2026) y muestra como puedes leer los correos enviado a tu usuario."),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("strong",{parentName:"p"},"Tarea 10 (No obligatoria):")," Instala un webmail (roundcube, horde, rainloop) para gestionar el correo del equipo mediante una interfaz web. Muestra la configuraci\xf3n necesaria y c\xf3mo eres capaz de leer los correos que recibe tu usuario.")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("strong",{parentName:"p"},"Tarea 11:")," Configura de manera adecuada postfix para que podamos mandar un correo desde un cliente remoto. La conexi\xf3n entre cliente y servidor debe estar autentificada con SASL usando dovecor y adem\xe1s debe estar cifrada. Para cifrar esta comunicaci\xf3n puedes usar dos opciones:"))),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"ESMTP + STARTTLS: Usando el puerto 567/tcp enviamos de forma segura el correo al servidor."),(0,t.kt)("li",{parentName:"ul"},"SMTPS: Utiliza un puerto no est\xe1ndar (465) para SMTPS (Simple Mail Transfer Protocol Secure). No es una extensi\xf3n de smtp. Es muy parecido a HTTPS.")),(0,t.kt)("p",null,"Elige una de las opciones anterior para realizar el cifrado. Y muestra la configuraci\xf3n de un cliente de correo (evolution, thunderbird, \u2026) y muestra como puedes enviar los correos."),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"Tarea 12 (No obligatoria):")," Configura el cliente webmail para el env\xedo de correo. Realiza una prueba de env\xedo con el webmail.")),(0,t.kt)("h2",{id:"comprobaci\xf3n-final"},"Comprobaci\xf3n final"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"Tarea 13:")," Prueba de env\xedo de correo. En esta ",(0,t.kt)("a",{parentName:"li",href:"https://www.mail-tester.com/"},"p\xe1gina")," tenemos una herramienta completa y f\xe1cil de usar a la que podemos enviar un correo para que verifique y punt\xfae el correo que enviamos. Captura la pantalla y muestra la puntuaci\xf3n que has sacado.")))}p.isMDXComponent=!0},56095:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-2-8f90359f4abccde1ddcf682cd8609eb4.png"},74373:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-3-f770d6527a241a9b60991afce83f9a7e.png"},26934:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-4-5a34f4cabcde32ad4e37ed3d1df10ef4.png"},84494:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-5-484d018ce3a0de93dbed3612080efee6.png"},49688:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-6-a80569c726a90ece3b920502b214626f.png"},88759:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-7-bd8fcc15b898ac45f90f3ec16adcd052.png"},51496:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-8-7857857e1c896e71accccd92b2580681.png"},38050:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-9-ba6541e714f2008072440c9448c3a5cb.png"},31941:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-6cdc7426ad77c3e1296fb0be4a7e8272.png"}}]);