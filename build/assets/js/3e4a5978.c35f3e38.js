"use strict";(self.webpackChunkotter_shell=self.webpackChunkotter_shell||[]).push([[8015],{3905:(e,a,n)=>{n.d(a,{Zo:()=>p,kt:()=>g});var t=n(67294);function s(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function o(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,t)}return n}function l(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?o(Object(n),!0).forEach((function(a){s(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function r(e,a){if(null==e)return{};var n,t,s=function(e,a){if(null==e)return{};var n,t,s={},o=Object.keys(e);for(t=0;t<o.length;t++)n=o[t],a.indexOf(n)>=0||(s[n]=e[n]);return s}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var i=t.createContext({}),d=function(e){var a=t.useContext(i),n=a;return e&&(n="function"==typeof e?e(a):l(l({},a),e)),n},p=function(e){var a=d(e.components);return t.createElement(i.Provider,{value:a},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var a=e.children;return t.createElement(t.Fragment,{},a)}},m=t.forwardRef((function(e,a){var n=e.components,s=e.mdxType,o=e.originalType,i=e.parentName,p=r(e,["components","mdxType","originalType","parentName"]),c=d(n),m=s,g=c["".concat(i,".").concat(m)]||c[m]||u[m]||o;return n?t.createElement(g,l(l({ref:a},p),{},{components:n})):t.createElement(g,l({ref:a},p))}));function g(e,a){var n=arguments,s=a&&a.mdxType;if("string"==typeof e||s){var o=n.length,l=new Array(o);l[0]=m;var r={};for(var i in a)hasOwnProperty.call(a,i)&&(r[i]=a[i]);r.originalType=e,r[c]="string"==typeof e?e:s,l[1]=r;for(var d=2;d<o;d++)l[d]=n[d];return t.createElement.apply(null,l)}return t.createElement.apply(null,n)}m.displayName="MDXCreateElement"},21256:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>i,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>d});var t=n(87462),s=(n(67294),n(3905));const o={sidebar_position:52},l="Jenkins: Integraci\xf3n continua de aplicaci\xf3n django (Test)",r={unversionedId:"Tasks/jenkins_django",id:"Tasks/jenkins_django",title:"Jenkins: Integraci\xf3n continua de aplicaci\xf3n django (Test)",description:"Vamos a trabajar con el repositorio de la aplicaci\xf3n djangotutorial. Esta aplicaci\xf3n tiene definidas una serie de test, que podemos estudiar en el fichero tests.py del directorio polls.",source:"@site/docs/Tasks/jenkins_django.md",sourceDirName:"Tasks",slug:"/Tasks/jenkins_django",permalink:"/docs/Tasks/jenkins_django",draft:!1,editUrl:"https://github.com/belennazareth/ottershell/blob/main/docs/Tasks/jenkins_django.md",tags:[],version:"current",sidebarPosition:52,frontMatter:{sidebar_position:52},sidebar:"tutorialSidebar",previous:{title:"Jenkins: Corrector ortogr\xe1fico de documentos markdown (test)",permalink:"/docs/Tasks/jenkins_corrector"},next:{title:"Jenkins: Comprobaci\xf3n de HTML5 v\xe1lido y despliegue en surge.sh (test y deploy)",permalink:"/docs/Tasks/jenkins_surge"}},i={},d=[{value:"Pipeline para realizar un test autom\xe1tico",id:"pipeline-para-realizar-un-test-autom\xe1tico",level:2},{value:"Entrega",id:"entrega",level:2},{value:"1. Una captura de pantalla donde se vea la salida de un build que se ha ejecutado de manera correcta.",id:"1-una-captura-de-pantalla-donde-se-vea-la-salida-de-un-build-que-se-ha-ejecutado-de-manera-correcta",level:3},{value:"2. Modifica el c\xf3digo de la aplicaci\xf3n para que se produzca un fallo en el c\xf3digo. <em>Recuerda que para hacer fallar un test, no hay que tocar el fichero test.py. Los test no se pasan porque al modificar el c\xf3digo de la aplicaci\xf3n se dejan de cumplir las condiciones indicadas en los test. Recuerda no elegir en el que hemos visto en este taller:mensaje </em>\u201cNo polls are available\u201d **.",id:"2-modifica-el-c\xf3digo-de-la-aplicaci\xf3n-para-que-se-produzca-un-fallo-en-el-c\xf3digo-recuerda-que-para-hacer-fallar-un-test-no-hay-que-tocar-el-fichero-testpy-los-test-no-se-pasan-porque-al-modificar-el-c\xf3digo-de-la-aplicaci\xf3n-se-dejan-de-cumplir-las-condiciones-indicadas-en-los-test-recuerda-no-elegir-en-el-que-hemos-visto-en-este-tallermensaje-no-polls-are-available-",level:3},{value:"3. Una captura de pantalla donde se vea la salida de un build que se ha ejecutado con errores de testeo.",id:"3-una-captura-de-pantalla-donde-se-vea-la-salida-de-un-build-que-se-ha-ejecutado-con-errores-de-testeo",level:3}],p={toc:d},c="wrapper";function u(e){let{components:a,...o}=e;return(0,s.kt)(c,(0,t.Z)({},p,o,{components:a,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"jenkins-integraci\xf3n-continua-de-aplicaci\xf3n-django-test"},"Jenkins: Integraci\xf3n continua de aplicaci\xf3n django (Test)"),(0,s.kt)("p",null,"Vamos a trabajar con el repositorio de la aplicaci\xf3n ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/josedom24/django_tutorial"},"django_tutorial"),". Esta aplicaci\xf3n tiene definidas una serie de test, que podemos estudiar en el fichero ",(0,s.kt)("inlineCode",{parentName:"p"},"tests.py")," del directorio ",(0,s.kt)("inlineCode",{parentName:"p"},"polls"),"."),(0,s.kt)("p",null,"Cada test viene definido por una funci\xf3n. En el fichero puedes leer los comentarios para saber que es lo que prueba cada test, o puedes ver el documento ",(0,s.kt)("a",{parentName:"p",href:"https://fp.josedomingo.org/iaw2223/7_ic/test_tutorial_django.html"},"Tests en la aplicaci\xf3n tutorial Django"),"."),(0,s.kt)("p",null,"Para ejecutar los test ejecutamos:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"python3 manage.py test\n")),(0,s.kt)("p",null,"En ese momento se crea una base de datos temporal, donde se van a ir realizando las pruebas que est\xe1n definidas:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"python3 manage.py test\nCreating test database for alias 'default'...\nSystem check identified no issues (0 silenced).\n..........\n----------------------------------------------------------------------\nRan 10 tests in 0.024s\n\nOK\nDestroying test database for alias 'default'...\n")),(0,s.kt)("p",null,"Por ejemplo, hay dos tests definidos en la funci\xf3n test_no_questions y en la funci\xf3n test_future_question que comprueban que si no hay preguntas en la base de datos debe aparecer el mensaje ",(0,s.kt)("strong",{parentName:"p"},"\u201cNo polls are available\u201d"),". Si un programador modifica la aplicaci\xf3n y en el fichero ",(0,s.kt)("inlineCode",{parentName:"p"},"polls/templates/polls/index.html")," y cambia el mensaje:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-html"},"...\n    <p>No hay encuestas disponibles.</p>\n...\n")),(0,s.kt)("p",null,"Al pasar los test, tendremos dos errores en los dos tests:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'python3 manage.py test\nCreating test database for alias \'default\'...\nSystem check identified no issues (0 silenced).\n..F.F.....\n======================================================================\nFAIL: test_future_question (polls.tests.QuestionIndexViewTests)\nQuestions with a pub_date in the future aren\'t displayed on\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File "/home/jose/github/django_tutorial/polls/tests.py", line 143, in test_future_question\n    self.assertContains(response, "No polls are available.")\n  File "/home/jose/virtualenv/django_tutorial/lib/python3.9/site-packages/django/test/testcases.py", line 471, in assertContains\n    self.assertTrue(real_count != 0, msg_prefix + "Couldn\'t find %s in response" % text_repr)\nAssertionError: False is not true : Couldn\'t find \'No polls are available.\' in response\n\n======================================================================\nFAIL: test_no_questions (polls.tests.QuestionIndexViewTests)\nIf no questions exist, an appropriate message is displayed.\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File "/home/jose/github/django_tutorial/polls/tests.py", line 115, in test_no_questions\n    self.assertContains(response, "No polls are available.")\n  File "/home/jose/virtualenv/django_tutorial/lib/python3.9/site-packages/django/test/testcases.py", line 471, in assertContains\n    self.assertTrue(real_count != 0, msg_prefix + "Couldn\'t find %s in response" % text_repr)\nAssertionError: False is not true : Couldn\'t find \'No polls are available.\' in response\n\n----------------------------------------------------------------------\nRan 10 tests in 0.022s\n\nFAILED (failures=2)\n')),(0,s.kt)("p",null,"Recuerda que para hacer fallar un ",(0,s.kt)("inlineCode",{parentName:"p"},"test"),", no hay que tocar el fichero ",(0,s.kt)("inlineCode",{parentName:"p"},"test.py"),". Los test no se pasan porque al modificar el c\xf3digo de la aplicaci\xf3n se dejan de cumplir las condiciones indicadas en los test."),(0,s.kt)("h2",{id:"pipeline-para-realizar-un-test-autom\xe1tico"},"Pipeline para realizar un test autom\xe1tico"),(0,s.kt)("p",null,"Sabiendo como se ejecutan los test, es f\xe1cil hacer un pipeline que lo haga por nosotros de forma autom\xe1tica:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-groovy"},"pipeline {\n    agent {\n        docker { image 'python:3'\n        args '-u root:root'\n        }\n    }\n    stages {\n        stage('Clone') {\n            steps {\n                git branch:'master',url:'https://github.com/josedom24/django_tutorial.git'\n            }\n        }\n        stage('Install') {\n            steps {\n                sh 'pip install -r requirements.txt'\n            }\n        }\n        stage('Test')\n        {\n            steps {\n                sh 'python3 manage.py test'\n            }\n        }\n    }\n}\n")),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Para poder instalar los paquetes con pip necesitamos ejecutar las instrucciones en el contenedor como root (",(0,s.kt)("inlineCode",{parentName:"p"},"args '-u root:root'"),").")),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Clonamos el repositorio.")),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Instalamos los requerimientos.")),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Realizamos los test."))),(0,s.kt)("p",null,"Prueba a cambiar el c\xf3digo para que un test falle y comprueba como el ",(0,s.kt)("inlineCode",{parentName:"p"},"pipeline")," falla."),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"URL Repositorio:")," ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/belennazareth/django_tutorial.git"},"https://github.com/belennazareth/django_tutorial.git")),(0,s.kt)("h2",{id:"entrega"},"Entrega"),(0,s.kt)("h3",{id:"1-una-captura-de-pantalla-donde-se-vea-la-salida-de-un-build-que-se-ha-ejecutado-de-manera-correcta"},"1. Una captura de pantalla donde se vea la salida de un build que se ha ejecutado de manera correcta."),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"surge",src:n(84714).Z,width:"1250",height:"798"})),(0,s.kt)("h3",{id:"2-modifica-el-c\xf3digo-de-la-aplicaci\xf3n-para-que-se-produzca-un-fallo-en-el-c\xf3digo-recuerda-que-para-hacer-fallar-un-test-no-hay-que-tocar-el-fichero-testpy-los-test-no-se-pasan-porque-al-modificar-el-c\xf3digo-de-la-aplicaci\xf3n-se-dejan-de-cumplir-las-condiciones-indicadas-en-los-test-recuerda-no-elegir-en-el-que-hemos-visto-en-este-tallermensaje-no-polls-are-available-"},"2. Modifica el c\xf3digo de la aplicaci\xf3n para que se produzca un fallo en el c\xf3digo. ",(0,s.kt)("em",{parentName:"h3"},"Recuerda que para hacer fallar un test, no hay que tocar el fichero test.py. Los test no se pasan porque al modificar el c\xf3digo de la aplicaci\xf3n se dejan de cumplir las condiciones indicadas en los test. Recuerda no elegir en el que hemos visto en este taller:mensaje "),"\u201cNo polls are available\u201d **."),(0,s.kt)("p",null,"En mi caso seleccion\xe9:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-txt"},"1. En las preguntas publicadas en una fecha futura, la funci\xf3n was_published_recently() debe devolver False\n")),(0,s.kt)("p",null,"Esto ten\xeda antes el fichero:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-py"},"...\n    def was_published_recently(self):\n        now = timezone.now()\n        return now - datetime.timedelta(days=1) <= self.pub_date <= now\n    was_published_recently.admin_order_field = 'pub_date'\n    was_published_recently.boolean = True\n    was_published_recently.short_description = 'Published recently?'\n...\n")),(0,s.kt)("p",null,"Lo modifiqu\xe9 cambiando el valor ",(0,s.kt)("inlineCode",{parentName:"p"},"<=")," por ",(0,s.kt)("inlineCode",{parentName:"p"},"<"),":"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-py"},"...\n    def was_published_recently(self):\n        now = timezone.now()\n        return now - datetime.timedelta(days=1) < self.pub_date <= now\n    was_published_recently.admin_order_field = 'pub_date'\n    was_published_recently.boolean = True\n    was_published_recently.short_description = 'Published recently?'\n...\n")),(0,s.kt)("p",null,"Con esto la preguntas publicadas en una fecha futura no cumplen la condici\xf3n de ",(0,s.kt)("inlineCode",{parentName:"p"},"was_published_recently")," y por tanto el test ",(0,s.kt)("inlineCode",{parentName:"p"},"test_future_question")," falla."),(0,s.kt)("h3",{id:"3-una-captura-de-pantalla-donde-se-vea-la-salida-de-un-build-que-se-ha-ejecutado-con-errores-de-testeo"},"3. Una captura de pantalla donde se vea la salida de un build que se ha ejecutado con errores de testeo."),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"surge",src:n(87087).Z,width:"1920",height:"1053"})))}u.isMDXComponent=!0},87087:(e,a,n)=>{n.d(a,{Z:()=>t});const t=n.p+"assets/images/taller3IAW7-2-6dd49a3cb8ab1feb808267623b8b1d41.png"},84714:(e,a,n)=>{n.d(a,{Z:()=>t});const t=n.p+"assets/images/taller3IAW7-ce30ba6e57131aa2bf4ff4eeb00d6992.png"}}]);