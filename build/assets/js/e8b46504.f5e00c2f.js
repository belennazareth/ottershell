"use strict";(self.webpackChunkotter_shell=self.webpackChunkotter_shell||[]).push([[4271],{3905:(e,a,r)=>{r.d(a,{Zo:()=>d,kt:()=>k});var o=r(67294);function t(e,a,r){return a in e?Object.defineProperty(e,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[a]=r,e}function n(e,a){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);a&&(o=o.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),r.push.apply(r,o)}return r}function s(e){for(var a=1;a<arguments.length;a++){var r=null!=arguments[a]?arguments[a]:{};a%2?n(Object(r),!0).forEach((function(a){t(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}function l(e,a){if(null==e)return{};var r,o,t=function(e,a){if(null==e)return{};var r,o,t={},n=Object.keys(e);for(o=0;o<n.length;o++)r=n[o],a.indexOf(r)>=0||(t[r]=e[r]);return t}(e,a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(o=0;o<n.length;o++)r=n[o],a.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(t[r]=e[r])}return t}var i=o.createContext({}),c=function(e){var a=o.useContext(i),r=a;return e&&(r="function"==typeof e?e(a):s(s({},a),e)),r},d=function(e){var a=c(e.components);return o.createElement(i.Provider,{value:a},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var a=e.children;return o.createElement(o.Fragment,{},a)}},m=o.forwardRef((function(e,a){var r=e.components,t=e.mdxType,n=e.originalType,i=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=c(r),m=t,k=p["".concat(i,".").concat(m)]||p[m]||u[m]||n;return r?o.createElement(k,s(s({ref:a},d),{},{components:r})):o.createElement(k,s({ref:a},d))}));function k(e,a){var r=arguments,t=a&&a.mdxType;if("string"==typeof e||t){var n=r.length,s=new Array(n);s[0]=m;var l={};for(var i in a)hasOwnProperty.call(a,i)&&(l[i]=a[i]);l.originalType=e,l[p]="string"==typeof e?e:t,s[1]=l;for(var c=2;c<n;c++)s[c]=r[c];return o.createElement.apply(null,s)}return o.createElement.apply(null,r)}m.displayName="MDXCreateElement"},12082:(e,a,r)=>{r.r(a),r.d(a,{assets:()=>i,contentTitle:()=>s,default:()=>u,frontMatter:()=>n,metadata:()=>l,toc:()=>c});var o=r(87462),t=(r(67294),r(3905));const n={sidebar_position:21},s="Servidor de correos",l={unversionedId:"Tasks/correo_vps",id:"Tasks/correo_vps",title:"Servidor de correos",description:"Instala y configura de manera adecuada el servidor de correos en tu VPS. El nombre del servidor de correo ser\xe1 mail.tudominio.es (este es el nombre que deber\xe1 aparecer en el registro MX).",source:"@site/docs/Tasks/correo_vps.md",sourceDirName:"Tasks",slug:"/Tasks/correo_vps",permalink:"/docs/Tasks/correo_vps",draft:!1,editUrl:"https://github.com/belennazareth/ottershell/blob/main/docs/Tasks/correo_vps.md",tags:[],version:"current",sidebarPosition:21,frontMatter:{sidebar_position:21},sidebar:"tutorialSidebar",previous:{title:"Recolecci\xf3n centralizada de logs del sistema",permalink:"/docs/Tasks/journald"},next:{title:"Despliegue de aplicaciones Java",permalink:"/docs/Tasks/despliegue_java"}},i={},c=[{value:"Gesti\xf3n de correos desde el servidor",id:"gesti\xf3n-de-correos-desde-el-servidor",level:2},{value:"Uso de alias y redirecciones",id:"uso-de-alias-y-redirecciones",level:2},{value:"Configura el cron para enviar correo al usuario <code>root</code>. Comprueba que est\xe1n llegando esos correos al root. Crea un nuevo alias para que se manden a un usuario sin privilegios. Comprueba que llegan a ese usuario. Por \xfaltimo crea una redirecci\xf3n para enviar esos correos a tu correo personal (gmail,hotmail,\u2026).",id:"configura-el-cron-para-enviar-correo-al-usuario-root-comprueba-que-est\xe1n-llegando-esos-correos-al-root-crea-un-nuevo-alias-para-que-se-manden-a-un-usuario-sin-privilegios-comprueba-que-llegan-a-ese-usuario-por-\xfaltimo-crea-una-redirecci\xf3n-para-enviar-esos-correos-a-tu-correo-personal-gmailhotmail",level:2},{value:"Para asegurar el env\xedo",id:"para-asegurar-el-env\xedo",level:2},{value:"Para luchar contra el SPAM",id:"para-luchar-contra-el-spam",level:2},{value:"Gesti\xf3n de correos desde un cliente",id:"gesti\xf3n-de-correos-desde-un-cliente",level:2},{value:"Comprobaci\xf3n final",id:"comprobaci\xf3n-final",level:2}],d={toc:c},p="wrapper";function u(e){let{components:a,...n}=e;return(0,t.kt)(p,(0,o.Z)({},d,n,{components:a,mdxType:"MDXLayout"}),(0,t.kt)("h1",{id:"servidor-de-correos"},"Servidor de correos"),(0,t.kt)("p",null,"Instala y configura de manera adecuada el servidor de correos en tu VPS. El nombre del servidor de correo ser\xe1 mail.tudominio.es (este es el nombre que deber\xe1 aparecer en el registro MX)."),(0,t.kt)("h2",{id:"gesti\xf3n-de-correos-desde-el-servidor"},"Gesti\xf3n de correos desde el servidor"),(0,t.kt)("p",null,"El env\xedo y recepci\xf3n se har\xe1 desde el servidor usando la herramienta mail."),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"Tarea 1:")," Documenta una prueba de funcionamiento, donde env\xedes desde tu servidor local al exterior. Muestra el log donde se vea el env\xedo. Muestra el correo que has recibido. Muestra el registro SPF.")),(0,t.kt)("hr",null),(0,t.kt)("p",null,"Instalamos postfix en la VPS:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ sudo apt install postfix\n")),(0,t.kt)("p",null,"Y bsd-mailx para poder enviar correos desde la VPS:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ sudo apt install bsd-mailx\n")),(0,t.kt)("p",null,"En la VPS a\xf1ado un registro MX para que apunte a mail.ottershell.es. Compruebo que el registro MX est\xe1 bien configurado:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ dig MX ottershell.es\n")),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Postfix",src:r(31941).Z,width:"729",height:"533"})),(0,t.kt)("p",null,"A\xf1ado el puerto 25 al firewall de la VPS.\nY el DNS inverso a ",(0,t.kt)("inlineCode",{parentName:"p"},"buizel.ottershell.es")),(0,t.kt)("p",null,"Aqu\xed se puede ver el el mensaje que se ha enviado desde la VPS a mi correo personal y los logs de mail:"),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Postfix",src:r(56095).Z,width:"533",height:"345"}),"\n",(0,t.kt)("img",{alt:"Postfix",src:r(74373).Z,width:"1908",height:"429"})),(0,t.kt)("p",null,"Obtenemos de registro SPF:"),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Postfix",src:r(26934).Z,width:"1556",height:"970"})),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"Tarea 2:")," Documenta una prueba de funcionamiento, donde env\xedes un correo desde el exterior (gmail, hotmail,\u2026) a tu servidor local. Muestra el log donde se vea el env\xedo. Muestra c\xf3mo has le\xeddo el correo. Muestra el registro MX de tu dominio.")),(0,t.kt)("hr",null),(0,t.kt)("p",null,"Para esto voy a responder al correo recibido en la tarea anterior desde mi correo personal a la VPS:"),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Postfix",src:r(84494).Z,width:"616",height:"506"})),(0,t.kt)("p",null,"Para leer el correo desde la VPS:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ mail\n")),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Postfix",src:r(49688).Z,width:"700",height:"123"}),"\n",(0,t.kt)("img",{alt:"Postfix",src:r(88759).Z,width:"809",height:"1017"})),(0,t.kt)("p",null,"Aqu\xed vemos el log de mail:"),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Postfix",src:r(51496).Z,width:"1908",height:"352"})),(0,t.kt)("p",null,"En el ejercicio anterior se explica el registro MX de mi dominio, como se puede ver en la imagen siguiente al hacer un dig MX a mi dominio:"),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Postfix",src:r(38050).Z,width:"781",height:"639"})),(0,t.kt)("h2",{id:"uso-de-alias-y-redirecciones"},"Uso de alias y redirecciones"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"Tarea 3:")," Uso de alias y redirecciones.")),(0,t.kt)("p",null,"Vamos a comprobar como los procesos del servidor pueden mandar correos para informar sobre su estado. Por ejemplo cada vez que se ejecuta una tarea cron podemos enviar un correo informando del resultado. Normalmente estos correos se mandan al usuario ",(0,t.kt)("inlineCode",{parentName:"p"},"root")," del servidor, para ello:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ crontab -e\n")),(0,t.kt)("p",null,"E indico donde se env\xeda el correo:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"MAILTO = root\n")),(0,t.kt)("p",null,"Puedes poner alguna tarea en el cron para ver como se mandan correo."),(0,t.kt)("p",null,"Posteriormente usando alias y redirecciones podemos hacer llegar esos correos a nuestro correo personal."),(0,t.kt)("h2",{id:"configura-el-cron-para-enviar-correo-al-usuario-root-comprueba-que-est\xe1n-llegando-esos-correos-al-root-crea-un-nuevo-alias-para-que-se-manden-a-un-usuario-sin-privilegios-comprueba-que-llegan-a-ese-usuario-por-\xfaltimo-crea-una-redirecci\xf3n-para-enviar-esos-correos-a-tu-correo-personal-gmailhotmail"},"Configura el cron para enviar correo al usuario ",(0,t.kt)("inlineCode",{parentName:"h2"},"root"),". Comprueba que est\xe1n llegando esos correos al root. Crea un nuevo alias para que se manden a un usuario sin privilegios. Comprueba que llegan a ese usuario. Por \xfaltimo crea una redirecci\xf3n para enviar esos correos a tu correo personal (gmail,hotmail,\u2026)."),(0,t.kt)("p",null,"Para configurar el cron para enviar correos al usuario root:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ crontab -e\nMAILTO = root\n")),(0,t.kt)("p",null,"Vamos a poner una tarea para ver como se mandan correos:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},'MAILTO = root\n* * * * * echo "Hola caracolas :)"\n')),(0,t.kt)("p",null,"Comprobamos que llegan los correos al root:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"mail\n")),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Postfix",src:r(94852).Z,width:"1068",height:"690"}),"\n",(0,t.kt)("img",{alt:"Postfix",src:r(34681).Z,width:"1908",height:"367"})),(0,t.kt)("p",null,"Creamos un nuevo alias para que se manden a un usuario sin privilegios:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ sudo nano /etc/aliases\n    root: poke\n")),(0,t.kt)("p",null,"Actualizamos los cambios:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ sudo newaliases\n")),(0,t.kt)("p",null,"Comprobamos que llegan los correos al usuario poke:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ mail\n")),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Postfix",src:r(43618).Z,width:"949",height:"668"}),"\n",(0,t.kt)("img",{alt:"Postfix",src:r(68488).Z,width:"1908",height:"398"})),(0,t.kt)("p",null,"Por \xfaltimo creamos un fichero que hara de redirecci\xf3n para enviar esos correos a mi correo personal:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ nano /home/poke/.forward\n")),(0,t.kt)("p",null,"Dentro del fichero escribimos el correo personal."),(0,t.kt)("p",null,"Comprobamos que llegan los correos a mi correo personal:"),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Postfix",src:r(43946).Z,width:"1572",height:"427"}),"\n",(0,t.kt)("img",{alt:"Postfix",src:r(23299).Z,width:"1909",height:"400"})),(0,t.kt)("h2",{id:"para-asegurar-el-env\xedo"},"Para asegurar el env\xedo"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"Tarea 4 (No obligatoria):")," Configura de manera adecuada DKIM es tu sistema de correos. Comprueba el registro DKIM en la p\xe1gina ",(0,t.kt)("a",{parentName:"li",href:"https://mxtoolbox.com/dkim.aspx"},"https://mxtoolbox.com/dkim.aspx"),". Configura postfix para que firme los correos que env\xeda. Manda un correo y comprueba la verificaci\xf3n de las firmas en ellos.")),(0,t.kt)("p",null,"Instalamos opendkim:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ sudo apt install opendkim opendkim-tools -y\n")),(0,t.kt)("p",null,"Editamos el fichero de configuraci\xf3n:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ sudo nano /etc/opendkim.conf\n")),(0,t.kt)("p",null,"Modificamos la siguiente l\xednea:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-c"},"Domain                  ottershell.es\nSelector                default\nKeyFile                 /etc/opendkim/keys/ottershell.es/default.private\nSocket                  local:/var/spool/postfix/opendkim/opendkim.sock\nPidFile                 /run/opendkim/opendkim.pid\nTrustAnchorFile         /usr/share/dns/root.key\n")),(0,t.kt)("p",null,"A\xf1adimos el socket:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ sudo nano /etc/default/opendkim\n")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-c"},"SOCKET=local:/var/spool/postfix/opendkim/opendkim.sock\n")),(0,t.kt)("p",null,"Editamos el fichero de configuraci\xf3n de postfix:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ sudo nano /etc/postfix/main.cf\n")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-c"},"milter_default_action = accept\nmilter_protocol = 6\nsmtpd_milters = local:/opendkim/opendkim.sock\nnon_smtpd_milters = $smtpd_milters\n")),(0,t.kt)("p",null,"Creamos el directorio de las claves:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"sudo mkdir /etc/opendkim/keys/ottershell.es\ncd /etc/opendkim/keys/ottershell.es\nopendkim-genkey -d ottershell.es -D /etc/opendkim/keys/ottershell.es -s mail-dkim -v\n")),(0,t.kt)("p",null,"Hacemos un cat del fichero default.txt y copiamos el contenido:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ cat default.txt\n")),(0,t.kt)("p",null,"Con esto creamos el registro TXT en el DNS de nuestro dominio:"),(0,t.kt)("p",null,"Entrada: ",(0,t.kt)("inlineCode",{parentName:"p"},"mail-dkim._domainkey.ottershell.es"),"\nTipo: ",(0,t.kt)("inlineCode",{parentName:"p"},"TXT"),"\nValor:  ",(0,t.kt)("inlineCode",{parentName:"p"},"v=DKIM1;h=sha256;k=rsa;p=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAppoCIzH/ycc4rS6L4VRU4FAgMyO+HitduBsRWDU1k1C25xRoCj631XdbiODKdf6NfSzcwbHBTRlfc2GY85rD+rtuRG4jvGd6OmnVjs690bVzT+nlhix5fxO4FuxgFxU9Q7DB9Nwan8Cjol+94cfkc1aCqN+zcrtLcDxmp400x783mia/todUZT+5dKCDqeuP3UheQTKWVTyqXuEcYurKMiRPGBG0ePodKiOn/I6WUJXz6/r8k6Rr/KKvfOoccM3q6/tn9Zryp3YDgINK6MXd1LTz/dSbaGj51ZhPLQAzziUhJepQL0GwjgQCi9Z/UHc3jfVfsYxp3L+QoGzCaCuo6wIDAQAB")),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Postfix",src:r(50460).Z,width:"1833",height:"102"})),(0,t.kt)("h2",{id:"para-luchar-contra-el-spam"},"Para luchar contra el SPAM"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("strong",{parentName:"p"},"Tarea 5 (No obligatorio):")," Configura de manera adecuada Postfix para que tenga en cuenta el registro SPF de los correos que recibe. Muestra el log del correo para comprobar que se est\xe1 haciendo el testeo del registro SPF.")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("strong",{parentName:"p"},"Tarea 6 (No obligatoria):")," Configura un sistema antispam. Realiza comprobaciones para comprobarlo.")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("strong",{parentName:"p"},"Tarea 7 (No obligatoria):")," Configura un sistema antivirus. Realiza comprobaciones para comprobarlo."))),(0,t.kt)("h2",{id:"gesti\xf3n-de-correos-desde-un-cliente"},"Gesti\xf3n de correos desde un cliente"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"Tarea 8:")," Configura el buz\xf3n de los usuarios de tipo Maildir. Env\xeda un correo a tu usuario y comprueba que el correo se ha guardado en el buz\xf3n Maildir del usuario del sistema correspondiente. Recuerda que ese tipo de buz\xf3n no se puede leer con la utilidad mail.")),(0,t.kt)("p",null,"Cambiamos a cambiar el tipo de buz\xf3n:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ sudo nano /etc/postfix/main.cf\n")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-c"},"home_mailbox = Maildir/\n")),(0,t.kt)("p",null,"Instalamos el cliente de correo:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ sudo apt install mutt -y\n$ sudo systemctl restart postfix\n")),(0,t.kt)("p",null,"Configuramos el cliente de correo:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ nano ~/.muttrc\n")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-c"},'set mbox_type=Maildir\nset mbox="~/Maildir"\nset folder="~/Maildir"\nset spoolfile="~/Maildir"\nset record="+.Sent"\nset postponed="+.Drafts"\nset mask="!^\\\\.[^.]"\n')),(0,t.kt)("p",null,"Comprobamos que funciona enviando un correo y verificando que se guarda en el buz\xf3n:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"mutt\n")),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Postfix",src:r(38471).Z,width:"834",height:"628"}),"\n",(0,t.kt)("img",{alt:"Postfix",src:r(79344).Z,width:"834",height:"628"})),(0,t.kt)("p",null,"Si vemos el directorio Maildir vemos que se han creado los directorios necesarios:"),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Postfix",src:r(599).Z,width:"711",height:"306"})),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"Tarea 9:")," Instala configura ",(0,t.kt)("inlineCode",{parentName:"li"},"dovecot")," para ofrecer el protocolo IMAP. Configura dovecot de manera adecuada para ofrecer autentificaci\xf3n y cifrado.")),(0,t.kt)("p",null,"Para realizar el cifrado de la comunicaci\xf3n crea un certificado en LetsEncrypt para tu dominio mail.tudominio.es. Recuerda que para ofrecer el cifrado tiene varias soluciones:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"IMAP con STARTTLS: STARTTLS transforma una conexi\xf3n insegura en una segura mediante el uso de SSL/TLS. Por lo tanto usando el mismo puerto 143/tcp tenemos cifrada la comunicaci\xf3n.")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"IMAPS: Versi\xf3n segura del protocolo IMAP que usa el puerto 993/tcp.")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"Ofrecer las dos posibilidades."))),(0,t.kt)("p",null,"Elige una de las opciones anterior para realizar el cifrado. Y muestra la configuraci\xf3n de un cliente de correo (evolution, thunderbird, \u2026) y muestra como puedes leer los correos enviado a tu usuario."),(0,t.kt)("hr",null),(0,t.kt)("p",null,"Instalamos dovecot:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ sudo apt install dovecot-imapd -y\n")),(0,t.kt)("p",null,"Creamos el certificado:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ sudo certbot certonly --standalone -d mail.ottershell.es\n")),(0,t.kt)("p",null,"Editamos el fichero de configuraci\xf3n:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ sudo nano /etc/dovecot/conf.d/10-ssl.conf\n")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-c"},"ssl_cert = </etc/letsencrypt/live/mail.ottershell.es/fullchain.pem\nssl_key = </etc/letsencrypt/live/mail.ottershell.es/privkey.pem\n")),(0,t.kt)("p",null,"Editamos el fichero de configuraci\xf3n de correo:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ sudo nano /etc/dovecot/conf.d/10-mail.conf\n")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-c"},"mail_location = maildir:~/Maildir\n")),(0,t.kt)("p",null,"Reiniciamos el servicio:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ sudo systemctl restart dovecot\n")),(0,t.kt)("p",null,"Abrimos el puerto 993 en el firewall de la VPS."),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("strong",{parentName:"p"},"Tarea 10 (No obligatoria):")," Instala un webmail (roundcube, horde, rainloop) para gestionar el correo del equipo mediante una interfaz web. Muestra la configuraci\xf3n necesaria y c\xf3mo eres capaz de leer los correos que recibe tu usuario.")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("strong",{parentName:"p"},"Tarea 11:")," Configura de manera adecuada postfix para que podamos mandar un correo desde un cliente remoto. La conexi\xf3n entre cliente y servidor debe estar autentificada con SASL usando dovecor y adem\xe1s debe estar cifrada. Para cifrar esta comunicaci\xf3n puedes usar dos opciones:"))),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"ESMTP + STARTTLS: Usando el puerto 567/tcp enviamos de forma segura el correo al servidor."),(0,t.kt)("li",{parentName:"ul"},"SMTPS: Utiliza un puerto no est\xe1ndar (465) para SMTPS (Simple Mail Transfer Protocol Secure). No es una extensi\xf3n de smtp. Es muy parecido a HTTPS.")),(0,t.kt)("p",null,"Elige una de las opciones anterior para realizar el cifrado. Y muestra la configuraci\xf3n de un cliente de correo (evolution, thunderbird, \u2026) y muestra como puedes enviar los correos."),(0,t.kt)("hr",null),(0,t.kt)("p",null,"Modificamos el fichero de configuraci\xf3n:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ sudo nano /etc/postfix/main.cf\n")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-c"},"smtpd_tls_cert_file = /etc/letsencrypt/live/ottershell.es/fullchain.pem\nsmtpd_tls_key_file = /etc/letsencrypt/live/ottershell.es/privkey.pem\n\nsmtpd_sasl_auth_enable = yes\nsmtpd_sasl_type = dovecot\nsmtpd_sasl_path = private/auth\nsmtpd_sasl_authenticated_header = yes\nbroken_sasl_auth_clients = yes\n")),(0,t.kt)("p",null,"Editamos el fichero master.cf:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ sudo nano /etc/postfix/master.cf\n")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-c"},"submission inet n       -       y       -       -       smtpd\n  -o content_filter=spamassassin\n  -o syslog_name=postfix/submission\n  -o smtpd_tls_security_level=encrypt\n  -o smtpd_sasl_auth_enable=yes\n  -o smtpd_tls_auth_only=yes\n  -o smtpd_reject_unlisted_recipient=no\n  -o smtpd_client_restrictions=$mua_client_restrictions\n  -o smtpd_helo_restrictions=$mua_helo_restrictions\n  -o smtpd_sender_restrictions=$mua_sender_restrictions\n  -o smtpd_recipient_restrictions=\n  -o smtpd_relay_restrictions=permit_sasl_authenticated,reject\n  -o milter_macro_daemon_name=ORIGINATING\n\nsmtps     inet  n       -       y       -       -       smtpd\n  -o syslog_name=postfix/smtps\n  -o smtpd_tls_wrappermode=yes\n  -o smtpd_sasl_auth_enable=yes\n  -o smtpd_reject_unlisted_recipient=no\n  -o smtpd_client_restrictions=$mua_client_restrictions\n  -o smtpd_helo_restrictions=$mua_helo_restrictions\n  -o smtpd_sender_restrictions=$mua_sender_restrictions\n  -o smtpd_recipient_restrictions=\n  -o smtpd_relay_restrictions=permit_sasl_authenticated,reject\n  -o milter_macro_daemon_name=ORIGINATING\n")),(0,t.kt)("p",null,"Editamos el fichero de configuraci\xf3n de dovecot:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ sudo nano /etc/dovecot/conf.d/10-master.conf\n")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-c"},"service auth {\n  ...\n  # Postfix smtp-auth\n  unix_listener /var/spool/postfix/private/auth {\n    mode = 0666\n  }\n  ...\n}\n")),(0,t.kt)("p",null,"En la VPS abrimos los puertos 465 y el 993 que es el que abrimos en la actividad anterior.\nReinicamos el servicio:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"$ sudo systemctl restart postfix\n$ sudo systemctl restart dovecot\n")),(0,t.kt)("p",null,"Entramos en evolution y configuramos la cuenta de correo (editar>preferencias>cuentas>a\xf1adir):"),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Postfix",src:r(88618).Z,width:"1008",height:"700"}),"\n",(0,t.kt)("img",{alt:"Postfix",src:r(26065).Z,width:"1008",height:"700"}),"\n",(0,t.kt)("img",{alt:"Postfix",src:r(96597).Z,width:"1008",height:"700"}),"\n",(0,t.kt)("img",{alt:"Postfix",src:r(93369).Z,width:"1008",height:"700"})),(0,t.kt)("p",null,"Env\xedo un correo del exterior a mi cuenta de correo en la VPS:"),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Postfix",src:r(40731).Z,width:"1298",height:"671"})),(0,t.kt)("p",null,"Env\xedo un correo desde mi cuenta de correo en la VPS a mi cuenta de correo en el exterior:"),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Postfix",src:r(34645).Z,width:"1279",height:"649"}),"\n",(0,t.kt)("img",{alt:"Postfix",src:r(12871).Z,width:"961",height:"1053"})),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"Tarea 12 (No obligatoria):")," Configura el cliente webmail para el env\xedo de correo. Realiza una prueba de env\xedo con el webmail.")),(0,t.kt)("h2",{id:"comprobaci\xf3n-final"},"Comprobaci\xf3n final"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"Tarea 13:")," Prueba de env\xedo de correo. En esta ",(0,t.kt)("a",{parentName:"li",href:"https://www.mail-tester.com/"},"p\xe1gina")," tenemos una herramienta completa y f\xe1cil de usar a la que podemos enviar un correo para que verifique y punt\xfae el correo que enviamos. Captura la pantalla y muestra la puntuaci\xf3n que has sacado.")),(0,t.kt)("p",null,"Env\xedo un correo desde mi cuenta de correo en la VPS al que me ha dado la p\xe1gina:"),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Postfix",src:r(95729).Z,width:"642",height:"654"})),(0,t.kt)("p",null,"Y vemos el resultado en la p\xe1gina:"),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Postfix",src:r(64471).Z,width:"993",height:"1095"})))}u.isMDXComponent=!0},94852:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-10-f593edd4ac73955f2d64dbe352c311d3.png"},34681:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-11-f25bdc8a470143b180414b8d220510a5.png"},43618:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-12-d6bb4f65c54af0ac89702f8ffdc38844.png"},68488:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-13-a752c45cc73c1ab015571ed43985322d.png"},43946:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-14-b1e532926fab912e327fa3034a5861d2.png"},23299:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-15-ae91f7a7285ecd745ce54d276b95ff4c.png"},50460:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-16-588ff8deea7b4890f06001c7d129a8c5.png"},38471:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-17-aa02fabfdcd591a487d859ef037008d8.png"},79344:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-18-121350b9e1b13b78de26853daa863946.png"},599:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-19-20029caf27fdc0a8d817cc24ca0109e6.png"},56095:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-2-8f90359f4abccde1ddcf682cd8609eb4.png"},88618:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-20-e2e95ffd1e04477f7e602848ae14f0dc.png"},26065:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-21-ef1734b164a017d19b6f5f16e396ab92.png"},96597:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-22-3f1843883bec88299da346a34e7ac3e4.png"},93369:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-23-ba0c4adc6e9daee903229e4aa4a150f8.png"},40731:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-24-6a7c1b33d7a4986d3b51afa6fd802c95.png"},34645:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-25-f7cca78b0aec300bb7b911e1c745c65e.png"},12871:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-26-102725bdbaf4567080eab46e94a87193.png"},95729:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-27-5af5d91a6c98d049c68dccef32377223.png"},64471:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-28-eeddb57c35638d14585bfd92d273b483.png"},74373:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-3-f770d6527a241a9b60991afce83f9a7e.png"},26934:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-4-5a34f4cabcde32ad4e37ed3d1df10ef4.png"},84494:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-5-484d018ce3a0de93dbed3612080efee6.png"},49688:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-6-a80569c726a90ece3b920502b214626f.png"},88759:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-7-bd8fcc15b898ac45f90f3ec16adcd052.png"},51496:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-8-7857857e1c896e71accccd92b2580681.png"},38050:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-9-ba6541e714f2008072440c9448c3a5cb.png"},31941:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/correoSRI6-6cdc7426ad77c3e1296fb0be4a7e8272.png"}}]);