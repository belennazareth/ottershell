"use strict";(self.webpackChunkotter_shell=self.webpackChunkotter_shell||[]).push([[2319],{3905:(e,n,a)=>{a.d(n,{Zo:()=>p,kt:()=>m});var r=a(7294);function t(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function i(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,r)}return a}function o(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?i(Object(a),!0).forEach((function(n){t(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function l(e,n){if(null==e)return{};var a,r,t=function(e,n){if(null==e)return{};var a,r,t={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],n.indexOf(a)>=0||(t[a]=e[a]);return t}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(t[a]=e[a])}return t}var s=r.createContext({}),c=function(e){var n=r.useContext(s),a=n;return e&&(a="function"==typeof e?e(n):o(o({},n),e)),a},p=function(e){var n=c(e.components);return r.createElement(s.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},u=r.forwardRef((function(e,n){var a=e.components,t=e.mdxType,i=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=c(a),m=t,k=u["".concat(s,".").concat(m)]||u[m]||d[m]||i;return a?r.createElement(k,o(o({ref:n},p),{},{components:a})):r.createElement(k,o({ref:n},p))}));function m(e,n){var a=arguments,t=n&&n.mdxType;if("string"==typeof e||t){var i=a.length,o=new Array(i);o[0]=u;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:t,o[1]=l;for(var c=2;c<i;c++)o[c]=a[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,a)}u.displayName="MDXCreateElement"},2981:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var r=a(7462),t=(a(7294),a(3905));const i={sidebar_position:29},o="Instalaci\xf3n y configuraci\xf3n del servidor DHCP",l={unversionedId:"Tasks/configuracion_dhcp",id:"Tasks/configuracion_dhcp",title:"Instalaci\xf3n y configuraci\xf3n del servidor DHCP",description:"1.- Crea una infraestructura en QEMU/KVM que te permita tener una m\xe1quina donde instalar un servidor dhcp y un cliente que se configuren para tomar la configuraci\xf3n de forma din\xe1mica. El servidor estar\xe1 conectado al cliente por una red interna muy aislada.",source:"@site/docs/Tasks/configuracion_dhcp.md",sourceDirName:"Tasks",slug:"/Tasks/configuracion_dhcp",permalink:"/docs/Tasks/configuracion_dhcp",draft:!1,editUrl:"https://github.com/belennazareth/ottershell/blob/main/docs/Tasks/configuracion_dhcp.md",tags:[],version:"current",sidebarPosition:29,frontMatter:{sidebar_position:29},sidebar:"tutorialSidebar",previous:{title:"Delegaci\xf3n de subdominios con bind9",permalink:"/docs/Tasks/bind9_subdominios"},next:{title:"Markdown Features",permalink:"/docs/Tasks/markdown-features"}},s={},c=[{value:"Entrega",id:"entrega",level:2}],p={toc:c};function d(e){let{components:n,...a}=e;return(0,t.kt)("wrapper",(0,r.Z)({},p,a,{components:n,mdxType:"MDXLayout"}),(0,t.kt)("h1",{id:"instalaci\xf3n-y-configuraci\xf3n-del-servidor-dhcp"},"Instalaci\xf3n y configuraci\xf3n del servidor DHCP"),(0,t.kt)("p",null,"1.- Crea una infraestructura en QEMU/KVM que te permita tener una m\xe1quina donde instalar un servidor dhcp y un cliente que se configuren para tomar la configuraci\xf3n de forma din\xe1mica. El servidor estar\xe1 conectado al cliente por una red interna muy aislada."),(0,t.kt)("p",null,"Primero creamos las m\xe1quinas y copiamos la clave p\xfablica para acceder directamente a las m\xe1quinas ",(0,t.kt)("em",{parentName:"p"},"(ssh-copy-id dhcpclient/dhcpserver)"),"."),(0,t.kt)("p",null,"2.- Para instalar nuestro servidor dhcp ejecutamos:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"sudo -y apt-get install isc-dhcp-server\n")),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"Nota: Cuando instalamos el servidor por primera se produce un error, ya que no est\xe1 configurado. Puedes ver los errores producidos por el servidor en el fichero ",(0,t.kt)("inlineCode",{parentName:"strong"},"/var/log/syslog")," o ",(0,t.kt)("inlineCode",{parentName:"strong"},"systemctl -u isc-dhcp-server"),".")),(0,t.kt)("p",null,"3.- Vamos a configurar la interfaz por la que va a trabajar el servidor dhcp, para ello editamos el siguiente fichero ",(0,t.kt)("inlineCode",{parentName:"p"},"/etc/default/isc-dhcp-server"),". Donde configuramos el par\xe1metro interfaces (modif\xedcalo seg\xfan tu escenario), por ejemplo:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},'INTERFACES="eth1"\n')),(0,t.kt)("p",null,"En mi caso, la interfaz que voy a utilizar es ",(0,t.kt)("inlineCode",{parentName:"p"},"enp2s0"),":"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},'INTERFACESv4="enp2s0"    \n')),(0,t.kt)("p",null,"Para que el cliente reciba la configuraci\xf3n de forma din\xe1mica, debemos configurar la interfaz de red del cliente para que tome la configuraci\xf3n de forma din\xe1mica. Para ello editamos el fichero ",(0,t.kt)("inlineCode",{parentName:"p"},"/etc/network/interfaces")," y a\xf1adimos la siguiente l\xednea:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"    iface enp1s0 inet static\n        add 192.168.0.1     <<<\ud83c\udf38\ud83e\udd8e IP del servidor DHCP \ud83c\udf38\ud83e\udd8e\n        netmask 255.255.255.0\n")),(0,t.kt)("p",null,"Se usa una IP est\xe1tica para que el cliente pueda acceder al servidor dhcp, ya que de otra manera se conectar\xeda al dhcp de la red externa."),(0,t.kt)("p",null,"Despu\xe9s, configuramos el cliente para que tome la configuraci\xf3n de forma din\xe1mica, para ello editamos el fichero ",(0,t.kt)("inlineCode",{parentName:"p"},"/etc/network/interfaces")," y a\xf1adimos la siguiente l\xednea:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"    iface enp1s0 inet dhcp\n")),(0,t.kt)("p",null,"4.- Vamos a estudiar el fichero de configuraci\xf3n del servicio ",(0,t.kt)("inlineCode",{parentName:"p"},"/etc/dhcp/dhcpd.conf"),". "),(0,t.kt)("p",null,"El fichero de configuraci\xf3n est\xe1 dividido en dos partes:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("strong",{parentName:"p"},"Parte principal (valores por defecto):")," especifica los par\xe1metros generales que definen la concesi\xf3n y los par\xe1metros adicionales que se proporcionar\xe1n al cliente.")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("strong",{parentName:"p"},"Secciones (concretan a la principal):")),(0,t.kt)("ul",{parentName:"li"},(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"Subnet:")," Especifican rangos de direcciones IPs que ser\xe1n cedidas a los clientes que lo soliciten."),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"Host:")," Especificaciones concretas de equipos.")))),(0,t.kt)("p",null,"En la parte principal podemos configurar los siguientes par\xe1metros, que m\xe1s tarde podremos reescribir en las distintas secciones:"),(0,t.kt)("p",null,"Par\xe1metros de tiempos:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("strong",{parentName:"p"},"max-lease-time:")," Es el tiempo m\xe1ximo en segundos de concesi\xf3n que un cliente puede solicitar. Si por ejemplo, un cliente solicita una concesi\xf3n de 900 segundos pero el tiempo m\xe1ximo es de 600 segundos, la concesi\xf3n tendr\xe1 una duraci\xf3n de 600 segundos. No tiene por qu\xe9 ser T3 o temporizador de alquiler.")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("strong",{parentName:"p"},"min-lease-time:")," Es el tiempo m\xednimo en segundos de concesi\xf3n que un cliente puede solicitar. Si por ejemplo, un cliente solicita una concesi\xf3n de 900 segundos pero el tiempo m\xednimo es de 1200 segundos, la concesi\xf3n tendr\xe1 una duraci\xf3n de 1200 segundos.")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("strong",{parentName:"p"},"default-lease-time:")," Es el tiempo por defecto en segundos de concesi\xf3n que se le asignar\xe1 a un cliente en caso de que \xe9ste no haya solicitado ning\xfan periodo en concreto. Estos tres primeros par\xe1metro determinan el tiempo T3 o tiempo de concesi\xf3n.")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("strong",{parentName:"p"},"option dhcp-renewal-time:")," Es el tiempo en segundos que ha de transcurrir hasta que el cliente pase al estado RENEWING. Tambi\xe9n conocido como T1 o temporizador de renovaci\xf3n de alquiler. No confundir con default-lease-time.")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("strong",{parentName:"p"},"option dhcp-rebinding-time:")," Es el tiempo en segundos que ha de transcurrir hasta que el cliente pase al estado REBINDING. Tambi\xe9n conocido como T2 o temporizador de reenganche."))),(0,t.kt)("p",null,"Par\xe1metros de configuraci\xf3n:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("strong",{parentName:"p"},"option routers:")," Indicamos la direcci\xf3n red de la puerta de enlace que se utiliza para salir a internet.")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("strong",{parentName:"p"},"option domain-name-servers:")," Se pone las direcciones IP de los servidores DNS que va a utilizar el cliente.")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("strong",{parentName:"p"},"option domain-name:")," Nombre del dominio que se manda al cliente.")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("strong",{parentName:"p"},"option subnet-mask:")," Subred enviada a los clientes.")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("strong",{parentName:"p"},"option broadcast-address:")," Direcci\xf3n de difusi\xf3n de la red."))),(0,t.kt)("p",null,"Al indicar una secci\xf3n subnet tenemos que indicar la direcci\xf3n de la red y la mascara de red y entre llaves podemos poner los siguientes par\xe1metros:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("strong",{parentName:"p"},"range:")," Indicamos el rango de direcciones IP que vamos a asignar.")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"Algunos de los par\xe1metros que hemos explicado en la secci\xf3n principal."))),(0,t.kt)("p",null,"5.- Configura el servidor DHCP con las siguientes caracter\xedsticas"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Rango de direcciones a repartir: 192.168.0.100 - 192.168.0.110"),(0,t.kt)("li",{parentName:"ul"},"M\xe1scara de red: 255.255.255.0"),(0,t.kt)("li",{parentName:"ul"},"Duraci\xf3n de la concesi\xf3n: 1 hora"),(0,t.kt)("li",{parentName:"ul"},"Puerta de enlace: 192.168.0.1"),(0,t.kt)("li",{parentName:"ul"},"Servidores DNS: 192.168.202.2 y 1.1.1.1")),(0,t.kt)("p",null,"La configuraci\xf3n usando los datos de mis m\xe1quinas quedar\xeda:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"subnet 192.168.0.0 netmask 255.255.255.0 {\n  default-lease-time 3600;\n  max-lease-time 3600;  \n  range 192.168.0.100 192.168.0.110;\n  option subnet-mask 255.255.255.0;\n  option broadcast-address 192.168.0.255;\n  option routers 192.168.0.1;\n  option domain-name-servers 192.168.202.2, 1.1.1.1;\n}\n")),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"Nota 1: Si ponemos alg\xfan par\xe1metro fuera de la secci\xf3n subnet afectar\xe1 a todas las secciones subnet. Si dentro de la secci\xf3n subnet se reescribe el par\xe1metro no se utilizar\xe1 el valor del par\xe1metro general."),"\n",(0,t.kt)("strong",{parentName:"p"},"Nota 2: El tiempo T3 ser\xe1 default-lease-time si el cliente no ha solicitado tiempo de concesi\xf3n. Si el cliente lo ha solicitado no ser\xe1 mayor que max-lease-time ni menor que min-lease-time."),"\n",(0,t.kt)("strong",{parentName:"p"},"Nota 3: No hemos indicado ni el T1, ni el T2, por lo que estos valores se calcular\xe1n a partir de T3.")),(0,t.kt)("p",null,"6.- Configura los clientes para obtener direccionamiento din\xe1mico. Comprueba las configuraciones de red que han tomado los clientes."),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"Nota: En Windows la instrucci\xf3n ipconfig /release libera la concesi\xf3n, la instrucci\xf3n ipconfig /renew la renueva. En linux el comando para liberar la concesi\xf3n es dhclient -r y el que nos permite renovarla ser\xe1 dhclient.")),(0,t.kt)("p",null,"7.- El servidor debe hacer router-nat para que el cliente tenga acceso a internet. La configuraci\xf3n debe ser persistente."),(0,t.kt)("p",null,"8.- Cuando el servidor va repartiendo la configuraci\xf3n a los clientes va guardando las concesiones en el fichero /var/lib/dhcp/dhcpd.leases."),(0,t.kt)("h2",{id:"entrega"},"Entrega"),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"1.- Configuraci\xf3n del cliente para que configure la red de forma din\xe1mica.")),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"2.- Una vez que el cliente se haya configurado, capturas de pantalla donde se vea en el cliente: su direcci\xf3n IP, su puerta de enlace y su servidor DNS.")),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"3.- La concesi\xf3n que se ha hecho en el servidor. Estar\xe1 en el fichero donde se guarda la lista de concesiones.")),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"4.- Una comprobaci\xf3n del que el cliente puede hacer resoluci\xf3n a un nombre de internet.")))}d.isMDXComponent=!0}}]);