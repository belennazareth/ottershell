"use strict";(self.webpackChunkotter_shell=self.webpackChunkotter_shell||[]).push([[1408],{3905:(e,a,n)=>{n.d(a,{Zo:()=>u,kt:()=>k});var r=n(67294);function t(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function i(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?i(Object(n),!0).forEach((function(a){t(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function o(e,a){if(null==e)return{};var n,r,t=function(e,a){if(null==e)return{};var n,r,t={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],a.indexOf(n)>=0||(t[n]=e[n]);return t}(e,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(t[n]=e[n])}return t}var c=r.createContext({}),d=function(e){var a=r.useContext(c),n=a;return e&&(n="function"==typeof e?e(a):l(l({},a),e)),n},u=function(e){var a=d(e.components);return r.createElement(c.Provider,{value:a},e.children)},p="mdxType",s={inlineCode:"code",wrapper:function(e){var a=e.children;return r.createElement(r.Fragment,{},a)}},m=r.forwardRef((function(e,a){var n=e.components,t=e.mdxType,i=e.originalType,c=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),p=d(n),m=t,k=p["".concat(c,".").concat(m)]||p[m]||s[m]||i;return n?r.createElement(k,l(l({ref:a},u),{},{components:n})):r.createElement(k,l({ref:a},u))}));function k(e,a){var n=arguments,t=a&&a.mdxType;if("string"==typeof e||t){var i=n.length,l=new Array(i);l[0]=m;var o={};for(var c in a)hasOwnProperty.call(a,c)&&(o[c]=a[c]);o.originalType=e,o[p]="string"==typeof e?e:t,l[1]=o;for(var d=2;d<i;d++)l[d]=n[d];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},91569:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>c,contentTitle:()=>l,default:()=>s,frontMatter:()=>i,metadata:()=>o,toc:()=>d});var r=n(87462),t=(n(67294),n(3905));const i={sidebar_position:50},l="Docker: Implantaci\xf3n de aplicaciones web PHP en docker",o={unversionedId:"Tasks/docker_PHP",id:"Tasks/docker_PHP",title:"Docker: Implantaci\xf3n de aplicaciones web PHP en docker",description:"Imaginemos que el equipo de desarrollo de nuestra empresa ha desarrollado una aplicaci\xf3n PHP que se llama BookMedik (https://github.com/evilnapsis/bookmedik).",source:"@site/docs/Tasks/docker_PHP.md",sourceDirName:"Tasks",slug:"/Tasks/docker_PHP",permalink:"/docs/Tasks/docker_PHP",draft:!1,editUrl:"https://github.com/belennazareth/ottershell/blob/main/docs/Tasks/docker_PHP.md",tags:[],version:"current",sidebarPosition:50,frontMatter:{sidebar_position:50},sidebar:"tutorialSidebar",previous:{title:"Docker: Escenarios multicontenedor en Docker",permalink:"/docs/Tasks/docker_multicontenedor"},next:{title:"Markdown Features",permalink:"/docs/Tasks/markdown-features"}},c={},d=[{value:"Tarea 1: Creaci\xf3n de una imagen docker con una aplicaci\xf3n web desde una imagen base",id:"tarea-1-creaci\xf3n-de-una-imagen-docker-con-una-aplicaci\xf3n-web-desde-una-imagen-base",level:2},{value:"Entrega",id:"entrega",level:3},{value:"Tarea 2: Despliegue en el entorno de desarrollo",id:"tarea-2-despliegue-en-el-entorno-de-desarrollo",level:2},{value:"Entrega",id:"entrega-1",level:3},{value:"Tarea 3: Creaci\xf3n de una imagen docker con una aplicaci\xf3n web desde una imagen PHP",id:"tarea-3-creaci\xf3n-de-una-imagen-docker-con-una-aplicaci\xf3n-web-desde-una-imagen-php",level:2},{value:"Entrega",id:"entrega-2",level:3},{value:"Tarea 4: Ejecuci\xf3n de una aplicaci\xf3n PHP en docker con nginx (OPTATIVA)",id:"tarea-4-ejecuci\xf3n-de-una-aplicaci\xf3n-php-en-docker-con-nginx-optativa",level:2},{value:"Entrega",id:"entrega-3",level:3},{value:"Tarea 5: Puesta en producci\xf3n de nuestra aplicaci\xf3n",id:"tarea-5-puesta-en-producci\xf3n-de-nuestra-aplicaci\xf3n",level:2},{value:"Entrega",id:"entrega-4",level:3},{value:"Tarea 6: Modificaci\xf3n de la aplicaci\xf3n",id:"tarea-6-modificaci\xf3n-de-la-aplicaci\xf3n",level:2},{value:"Entrega",id:"entrega-5",level:3}],u={toc:d},p="wrapper";function s(e){let{components:a,...n}=e;return(0,t.kt)(p,(0,r.Z)({},u,n,{components:a,mdxType:"MDXLayout"}),(0,t.kt)("h1",{id:"docker-implantaci\xf3n-de-aplicaciones-web-php-en-docker"},"Docker: Implantaci\xf3n de aplicaciones web PHP en docker"),(0,t.kt)("p",null,"Imaginemos que el equipo de desarrollo de nuestra empresa ha desarrollado una aplicaci\xf3n PHP que se llama BookMedik (",(0,t.kt)("a",{parentName:"p",href:"https://github.com/evilnapsis/bookmedik"},"https://github.com/evilnapsis/bookmedik"),")."),(0,t.kt)("p",null,"Queremos crear una imagen Docker para implantar dicha aplicaci\xf3n."),(0,t.kt)("p",null,"Tenemos que tener en cuenta los siguientes aspectos:"),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"Contenedor mariadb")),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Es necesario que nuestra aplicaci\xf3n guarde su informaci\xf3n en un contenedor docker mariadb."),(0,t.kt)("li",{parentName:"ul"},"El script para generar la base de datos y los registros lo encuentras en el repositorio y se llama ",(0,t.kt)("inlineCode",{parentName:"li"},"schema.sql"),". Debes crear un usuario con su contrase\xf1a en la base de datos. La base de datos se llama bookmedik y se crea al ejecutar el script."),(0,t.kt)("li",{parentName:"ul"},"Ejecuta el contenedor mariadb y carga los datos del script ",(0,t.kt)("inlineCode",{parentName:"li"},"schema.sql"),". Para m\xe1s ",(0,t.kt)("a",{parentName:"li",href:"https://gist.github.com/spalladino/6d981f7b33f6e0afe6bb"},"informaci\xf3n"),"."),(0,t.kt)("li",{parentName:"ul"},"El contenedor mariadb debe tener un volumen para guardar la base de datos.")),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"Contenedor bookmedik")),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Vamos a crear tres versiones de la imagen que nos permite implantar la aplicaci\xf3n PHP."),(0,t.kt)("li",{parentName:"ul"},"La imagen debe crear las variables de entorno necesarias con datos de conexi\xf3n por defecto."),(0,t.kt)("li",{parentName:"ul"},"Al crear un contenedor a partir de estas im\xe1genes se ejecutar\xe1 un script bash que realizar\xe1 las siguientes tareas:",(0,t.kt)("ul",{parentName:"li"},(0,t.kt)("li",{parentName:"ul"},"Modifique el fichero core\\controller\\Database.php para que lea las variables de entorno. Para obtener las variables de entorno en PHP usar la funci\xf3n getenv. ",(0,t.kt)("a",{parentName:"li",href:"https://www.php.net/manual/es/function.getenv.php"},"Para m\xe1s informaci\xf3n"),"."),(0,t.kt)("li",{parentName:"ul"},"Inicialice la base de datos con el fichero ",(0,t.kt)("inlineCode",{parentName:"li"},"schema.sql"),"."),(0,t.kt)("li",{parentName:"ul"},"Ejecute el servidor web."))),(0,t.kt)("li",{parentName:"ul"},"El contenedor que creas debe tener un volumen para guardar los logs del servidor web."),(0,t.kt)("li",{parentName:"ul"},"La imagen la tienes que crear en tu entorno de desarrollo con el comando ",(0,t.kt)("inlineCode",{parentName:"li"},"docker build"),".")),(0,t.kt)("h2",{id:"tarea-1-creaci\xf3n-de-una-imagen-docker-con-una-aplicaci\xf3n-web-desde-una-imagen-base"},"Tarea 1: Creaci\xf3n de una imagen docker con una aplicaci\xf3n web desde una imagen base"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Vamos a crear una imagen que se llame ",(0,t.kt)("inlineCode",{parentName:"li"},"usuario/bookmedik:v1"),"."),(0,t.kt)("li",{parentName:"ul"},"Crea una imagen docker con la aplicaci\xf3n desde una imagen base de debian o ubuntu.")),(0,t.kt)("h3",{id:"entrega"},"Entrega"),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Entrega la url del repositorio GitHub donde tengas los ficheros necesarios para hacer la construcci\xf3n de la imagen.")),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Entrega una captura de pantalla donde se vea la imagen en el registro de tu entorno de desarrollo."))),(0,t.kt)("h2",{id:"tarea-2-despliegue-en-el-entorno-de-desarrollo"},"Tarea 2: Despliegue en el entorno de desarrollo"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Crea un script con ",(0,t.kt)("inlineCode",{parentName:"li"},"docker-compose")," que levante el escenario con los dos contenedores."),(0,t.kt)("li",{parentName:"ul"},"Recuerda que para acceder a la aplicaci\xf3n: Usuario: ",(0,t.kt)("strong",{parentName:"li"},"admin"),", contrase\xf1a: ",(0,t.kt)("strong",{parentName:"li"},"admin"),".")),(0,t.kt)("h3",{id:"entrega-1"},"Entrega"),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Entrega la url del repositorio GitHub donde hayas a\xf1adido el fichero docker-compose.yml.")),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Entrega la instrucci\xf3n para ver los dos contenedores del escenario funcionando.")),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Entrega una captura de pantalla donde se vea funcionando la aplicaci\xf3n, una vez que te has logueado."))),(0,t.kt)("h2",{id:"tarea-3-creaci\xf3n-de-una-imagen-docker-con-una-aplicaci\xf3n-web-desde-una-imagen-php"},"Tarea 3: Creaci\xf3n de una imagen docker con una aplicaci\xf3n web desde una imagen PHP"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Vamos a crear una imagen que se llame ",(0,t.kt)("inlineCode",{parentName:"li"},"usuario/bookmedik:v2"),"."),(0,t.kt)("li",{parentName:"ul"},"Realiza la imagen docker de la aplicaci\xf3n a partir de la imagen oficial ",(0,t.kt)("a",{parentName:"li",href:"https://hub.docker.com/_/php/"},"PHP")," que encuentras en docker hub. Lee la documentaci\xf3n de la imagen para configurar una imagen con apache2 y php, adem\xe1s seguramente tengas que instalar alguna extensi\xf3n de php."),(0,t.kt)("li",{parentName:"ul"},"Modifica el fichero ",(0,t.kt)("inlineCode",{parentName:"li"},"docker-compose.yml")," para probar esta imagen.")),(0,t.kt)("h3",{id:"entrega-2"},"Entrega"),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Entrega la url del repositorio GitHub donde tengas los ficheros necesarios para hacer la construcci\xf3n de la imagen.")),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Entrega una captura de pantalla donde se vea la imagen en el registro de tu entorno de desarrollo.")),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Entrega la instrucci\xf3n para ver los dos contenedores del escenario funcionando.")),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Entrega una captura de pantalla donde se vea funcionando la aplicaci\xf3n, una vez que te has logueado."))),(0,t.kt)("h2",{id:"tarea-4-ejecuci\xf3n-de-una-aplicaci\xf3n-php-en-docker-con-nginx-optativa"},"Tarea 4: Ejecuci\xf3n de una aplicaci\xf3n PHP en docker con nginx (OPTATIVA)"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Vamos a crear una imagen que se llame usuario/bookmedik:v3."),(0,t.kt)("li",{parentName:"ul"},"En este caso queremos usar un contenedor que utilice nginx para servir la aplicaci\xf3n PHP. Puedes crear la imagen desde una imagen base debian o ubuntu o desde la imagen oficial de nginx."),(0,t.kt)("li",{parentName:"ul"},"Vamos a crear otro contenedor que sirva php-fpm."),(0,t.kt)("li",{parentName:"ul"},"Para que funcione de forma adecuada el php-fpm tiene que tener acceso al directorio donde se encuentra la aplicaci\xf3n."),(0,t.kt)("li",{parentName:"ul"},"Y finalmente nuestro contenedor con la aplicaci\xf3n."),(0,t.kt)("li",{parentName:"ul"},"Crea un script con docker compose que levante el escenario con los tres contenedores.")),(0,t.kt)("p",null,"A lo mejor te puede ayudar el siguiente enlace: ",(0,t.kt)("a",{parentName:"p",href:"http://geekyplatypus.com/dockerise-your-php-application-with-nginx-and-php7-fpm/"},"Dockerise your PHP application with Nginx and PHP7-FPM")),(0,t.kt)("h3",{id:"entrega-3"},"Entrega"),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Entrega la url del repositorio GitHub donde tengas los ficheros necesarios para hacer la construcci\xf3n de la imagen.")),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Entrega una captura de pantalla donde se vea la imagen en el registro de tu entorno de desarrollo.")),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Entrega la instrucci\xf3n para ver los tres contenedores del escenario funcionando.")),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Entrega una captura de pantalla donde se vea funcionando la aplicaci\xf3n, una vez que te has logueado."))),(0,t.kt)("h2",{id:"tarea-5-puesta-en-producci\xf3n-de-nuestra-aplicaci\xf3n"},"Tarea 5: Puesta en producci\xf3n de nuestra aplicaci\xf3n"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Elige una de las tres im\xe1genes y s\xfabela a Docker Hub."),(0,t.kt)("li",{parentName:"ul"},"En tu VPS instala Docker y utilizando el ",(0,t.kt)("inlineCode",{parentName:"li"},"docker-compose.yml")," correspondiente, crea un contenedor en ella de la aplicaci\xf3n."),(0,t.kt)("li",{parentName:"ul"},"Configura el nginx de tu VPS para que haga de proxy inverso y nos permita acceder a la aplicaci\xf3n con ",(0,t.kt)("inlineCode",{parentName:"li"},"https://bookmedik.tudominio.xxx"),".")),(0,t.kt)("h3",{id:"entrega-4"},"Entrega"),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},"Entrega una captura de pantalla de Docker Hub donde se vea tu imagen subida."),(0,t.kt)("li",{parentName:"ol"},"Entrega la configuraci\xf3n de nginx."),(0,t.kt)("li",{parentName:"ol"},"Entrega una captura de pantalla donde se vea funcionando la aplicaci\xf3n, una vez que te has logueado.")),(0,t.kt)("h2",{id:"tarea-6-modificaci\xf3n-de-la-aplicaci\xf3n"},"Tarea 6: Modificaci\xf3n de la aplicaci\xf3n"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"En el entorno de desarrollo vamos a hacer una modificaci\xf3n de la aplicaci\xf3n. Por ejemplo modifica el fichero ",(0,t.kt)("inlineCode",{parentName:"li"},"core/app/view/login-view.php")," y pon tu nombre en la l\xednea ",(0,t.kt)("inlineCode",{parentName:"li"},'<h4 class="title">Acceder a BookMedik</h4>'),"."),(0,t.kt)("li",{parentName:"ul"},"Vamos a trabajar con la primera imagen que construimos. Vuelve a crear la imagen con la etiqueta ",(0,t.kt)("inlineCode",{parentName:"li"},"v1_2"),"."),(0,t.kt)("li",{parentName:"ul"},"Cambia el ",(0,t.kt)("inlineCode",{parentName:"li"},"docker-compose")," para probar el cambio."),(0,t.kt)("li",{parentName:"ul"},"Modifica la aplicaci\xf3n en producci\xf3n.")),(0,t.kt)("h3",{id:"entrega-5"},"Entrega"),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Entrega una captura de pantalla de Docker Hub donde se vea tu imagen subida.")),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Entrega una captura de pantalla donde se vea funcionando la aplicaci\xf3n, una vez que te has logueado."))))}s.isMDXComponent=!0}}]);