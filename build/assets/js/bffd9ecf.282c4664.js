"use strict";(self.webpackChunkotter_shell=self.webpackChunkotter_shell||[]).push([[633],{3905:(e,n,a)=>{a.d(n,{Zo:()=>c,kt:()=>b});var r=a(67294);function t(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function o(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,r)}return a}function s(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?o(Object(a),!0).forEach((function(n){t(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function l(e,n){if(null==e)return{};var a,r,t=function(e,n){if(null==e)return{};var a,r,t={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],n.indexOf(a)>=0||(t[a]=e[a]);return t}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(t[a]=e[a])}return t}var d=r.createContext({}),i=function(e){var n=r.useContext(d),a=n;return e&&(a="function"==typeof e?e(n):s(s({},n),e)),a},c=function(e){var n=i(e.components);return r.createElement(d.Provider,{value:n},e.children)},u="mdxType",p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var a=e.components,t=e.mdxType,o=e.originalType,d=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=i(a),m=t,b=u["".concat(d,".").concat(m)]||u[m]||p[m]||o;return a?r.createElement(b,s(s({ref:n},c),{},{components:a})):r.createElement(b,s({ref:n},c))}));function b(e,n){var a=arguments,t=n&&n.mdxType;if("string"==typeof e||t){var o=a.length,s=new Array(o);s[0]=m;var l={};for(var d in n)hasOwnProperty.call(n,d)&&(l[d]=n[d]);l.originalType=e,l[u]="string"==typeof e?e:t,s[1]=l;for(var i=2;i<o;i++)s[i]=a[i];return r.createElement.apply(null,s)}return r.createElement.apply(null,a)}m.displayName="MDXCreateElement"},35646:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>p,frontMatter:()=>o,metadata:()=>l,toc:()=>i});var r=a(87462),t=(a(67294),a(3905));const o={sidebar_position:23},s="Creaci\xf3n de un cl\xfaster DRBD + OCFS2",l={unversionedId:"Tasks/DRBD_OCFS2",id:"Tasks/DRBD_OCFS2",title:"Creaci\xf3n de un cl\xfaster DRBD + OCFS2",description:"Configura un escenario con dos m\xe1quinas. Cada una tiene que tener dos discos adicionales (tama\xf1o 2Gb para que la sincronizaci\xf3n sea r\xe1pida).",source:"@site/docs/Tasks/DRBD_OCFS2.md",sourceDirName:"Tasks",slug:"/Tasks/DRBD_OCFS2",permalink:"/docs/Tasks/DRBD_OCFS2",draft:!1,editUrl:"https://github.com/belennazareth/ottershell/blob/main/docs/Tasks/DRBD_OCFS2.md",tags:[],version:"current",sidebarPosition:23,frontMatter:{sidebar_position:23},sidebar:"tutorialSidebar",previous:{title:"Despliegue de aplicaciones Java",permalink:"/docs/Tasks/despliegue_java"},next:{title:"Despliegue de aplicaciones python",permalink:"/docs/Tasks/despliegue_python"}},d={},i=[],c={toc:i},u="wrapper";function p(e){let{components:n,...o}=e;return(0,t.kt)(u,(0,r.Z)({},c,o,{components:n,mdxType:"MDXLayout"}),(0,t.kt)("h1",{id:"creaci\xf3n-de-un-cl\xfaster-drbd--ocfs2"},"Creaci\xf3n de un cl\xfaster DRBD + OCFS2"),(0,t.kt)("p",null,"Configura un escenario con dos m\xe1quinas. Cada una tiene que tener dos discos adicionales (tama\xf1o 2Gb para que la sincronizaci\xf3n sea r\xe1pida)."),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Crea dos recursos DRBD: wwwdata y dbdata. Cada uno utilizar\xe1n uno de los discos de cada m\xe1quina."),(0,t.kt)("li",{parentName:"ul"},"Configura en modo Single-primary el recurso wwwdata.",(0,t.kt)("ul",{parentName:"li"},(0,t.kt)("li",{parentName:"ul"},"Una vez creado y sincronizado el recurso, format\xe9alo con XFS."),(0,t.kt)("li",{parentName:"ul"},"Monta el recurso en el nodo primario y crea un fichero. \xbfSe puede montar en el secundario?"),(0,t.kt)("li",{parentName:"ul"},"Desmonta el recurso."),(0,t.kt)("li",{parentName:"ul"},"Cambia los roles, pon primario el que era secundario, y secundario el primario."),(0,t.kt)("li",{parentName:"ul"},"Monta el recurso en el que ahora es primario y comprueba que existe el fichero creado anteriormente."))),(0,t.kt)("li",{parentName:"ul"},"Configura en modo Dual-primary el recurso dbdata.",(0,t.kt)("ul",{parentName:"li"},(0,t.kt)("li",{parentName:"ul"},"Una vez creado y sincronizado el recurso, config\xfaralo en modo Dual-primary."),(0,t.kt)("li",{parentName:"ul"},"Crea un cl\xfaster OCFS2."),(0,t.kt)("li",{parentName:"ul"},"Crea un volumen OCFS2 en el recurso (mkfs.ocfs2)."),(0,t.kt)("li",{parentName:"ul"},"Monta en los nodos el recurso, y prueba a escribir en los dos al mismo tiempo.")))),(0,t.kt)("p",null,"Montamos el escenario con dos m\xe1quinas virtuales, cada una con dos discos adicionales de 2GB en vagrant."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-ruby"},'Vagrant.configure("2") do |config|\n  config.vm.define "node1" do |node1|\n    node1.vm.box = "debian/bullseye64"\n    node1.vm.hostname = "node1"\n    node1.vm.synced_folder ".", "/vagrant", disabled: true\n    node1.vm.network "private_network", ip: "10.1.0.10"\n    node1.vm.provider :libvirt do |libvirt|\n        libvirt.storage :file, :size => \'2G\'\n        libvirt.storage :file, :size => \'2G\'\n    end\n\n  end\n  config.vm.define "node2" do |node2|\n    node2.vm.box = "debian/bullseye64"\n    node2.vm.hostname = "node2"\n    node2.vm.synced_folder ".", "/vagrant", disabled: true\n    node2.vm.network "private_network", ip: "10.1.0.11"\n    node2.vm.provider :libvirt do |libvirt|\n        libvirt.storage :file, :size => \'2G\'\n        libvirt.storage :file, :size => \'2G\'\n    end\n  end\nend\n')),(0,t.kt)("p",null,"Despu\xe9s de crear las m\xe1quinas, instalamos los paquetes necesarios para DRBD y OCFS2."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"apt install drbd-utils ocfs2-tools -y\n")),(0,t.kt)("p",null,"Creamos los recursos DRBD en cada m\xe1quina, en el fichero ",(0,t.kt)("inlineCode",{parentName:"p"},"/etc/drbd.d/wwwdata.res"),":"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"resource wwwdata {\n  protocol C;\n  meta-disk internal;\n  device /dev/drbd1;\n  syncer {\n    verify-alg sha1;\n  }\n  net {\n    allow-two-primaries;\n  }\n  on node1 {\n    disk /dev/vdb;\n    address 10.1.0.10:7789;\n  }\n  on node2 {\n    disk /dev/vdb;\n    address 10.1.0.11:7789;\n  }\n}\n")),(0,t.kt)("p",null,"Creamos el recurso en cada m\xe1quina:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"sudo drbdadm create-md wwwdata\nsudo drbdadm up wwwdata\n")),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"drbd",src:a(17201).Z,width:"507",height:"370"})),(0,t.kt)("p",null,"Creamos el recurso dbdata en cada m\xe1quina, en el fichero ",(0,t.kt)("inlineCode",{parentName:"p"},"/etc/drbd.d/dbdata.res"),":"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"resource dbdata {\n  protocol C;\n  meta-disk internal;\n  device /dev/drbd2;\n  syncer {\n    verify-alg sha1;\n  }\n  net {\n    allow-two-primaries;\n  }\n  on node1 {\n    disk /dev/vdc;\n    address 10.1.0.10:7790;\n  }\n  on node2 {\n    disk /dev/vdc;\n    address 10.1.0.11:7790;\n  }\n}\n")),(0,t.kt)("p",null,"Creamos el recurso en cada m\xe1quina:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"sudo drbdadm create-md dbdata\nsudo drbdadm up dbdata\n")),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"drbd",src:a(94755).Z,width:"504",height:"371"})),(0,t.kt)("p",null,"Configuramos el recurso wwwdata en modo Single-primary:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"sudo drbdadm primary --force wwwdata \n")),(0,t.kt)("p",null,"Y comprobamos el estado del recurso:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"sudo drbdadm status wwwdata\n")),(0,t.kt)("p",null,"Esperamos a que se sincronice el recurso y vemos que el estado es ",(0,t.kt)("inlineCode",{parentName:"p"},"UpToDate/UpToDate"),":"),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"drbd",src:a(56840).Z,width:"489",height:"345"})),(0,t.kt)("p",null,"En el nodo primario formateamos el recurso con XFS:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt install xfsprogs -y\nsudo mkfs.xfs /dev/drbd1\n")),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"drbd",src:a(31139).Z,width:"780",height:"306"})),(0,t.kt)("p",null,"Montamos y creamos un fichero en el nodo primario:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},'mount /dev/drbd1 /mnt\necho "Hola :)" > /mnt/fichero.txt\n')),(0,t.kt)("p",null,"Si intentamos montar el recurso en el nodo secundario, vemos que no se puede, si queremos hacer esto debemos desmontar el recurso en el nodo primario y cambiar los roles:"),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"drbd",src:a(79457).Z,width:"615",height:"77"})),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash"},"sudo umount /mnt\n\n\n## Entrega\n\n### 1. La salida del comando drbdadm status wwwdata.\n\n### 2. Prueba de funcionamiento del modo Single-primary.\n\n### 3. La salida del comando drbdadm status dbdata.\n\n### 4. Prueba de funcionamiento del modo Dual-primary.\n\n### 5. Muestra al profesor el funcionamiento del modo Dual-primary.\n")))}p.isMDXComponent=!0},94755:(e,n,a)=>{a.d(n,{Z:()=>r});const r=a.p+"assets/images/taller3SRI7-2-18dd3b3a5180217ed79028210cb08993.png"},56840:(e,n,a)=>{a.d(n,{Z:()=>r});const r=a.p+"assets/images/taller3SRI7-4-d5aeeed256311f7ab3439c9ced439b66.png"},31139:(e,n,a)=>{a.d(n,{Z:()=>r});const r=a.p+"assets/images/taller3SRI7-5-0c5bfc90109efab0735d767d932c6df8.png"},79457:(e,n,a)=>{a.d(n,{Z:()=>r});const r=a.p+"assets/images/taller3SRI7-6-a9709f52ad82a6a15b85a9936236cb2c.png"},17201:(e,n,a)=>{a.d(n,{Z:()=>r});const r=a.p+"assets/images/taller3SRI7-6b6fa643e0816229d6cdd860578fa974.png"}}]);