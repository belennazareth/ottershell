<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Tasks/https">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Configuraci√≥n de HTTPS en el VPS | OtterShell</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ottershell.vercel.app//docs/Tasks/https"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Configuraci√≥n de HTTPS en el VPS | OtterShell"><meta data-rh="true" name="description" content="Vamos a configurar el protocolo HTTPS para el acceso a nuestras aplicaciones, para ello tienes que tener en cuenta los siguiente:"><meta data-rh="true" property="og:description" content="Vamos a configurar el protocolo HTTPS para el acceso a nuestras aplicaciones, para ello tienes que tener en cuenta los siguiente:"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ottershell.vercel.app//docs/Tasks/https"><link data-rh="true" rel="alternate" href="https://ottershell.vercel.app//docs/Tasks/https" hreflang="en"><link data-rh="true" rel="alternate" href="https://ottershell.vercel.app//docs/Tasks/https" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="OtterShell RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="OtterShell Atom Feed"><link rel="stylesheet" href="/assets/css/styles.9d6e4550.css">
<link rel="preload" href="/assets/js/runtime~main.a31030ca.js" as="script">
<link rel="preload" href="/assets/js/main.03ec692b.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">OtterShell</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Blog</a><a class="navbar__item navbar__link" href="/blog">Contacto</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/belennazareth/ottershell" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Sobre m√≠</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/tasks">Tasks</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tasks&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/intro_git">Introducci√≥n a git y GitHub</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/markdown">Introducci√≥n a Markdown</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/ramas_uniones">Git. Trabajando con ramas y uniones</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/makefile_aso">Compilaci√≥n de un programa en C utilizando un Makefile.</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/gestion_paqueteria_aso">Ejercicios gesti√≥n de paqueter√≠a</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/router_nat">Creaci√≥n y configuraci√≥n de un escenario router-nat</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/clonacion_instantanea">Clonaci√≥n e instant√°neas de m√°quinas virtuales</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/manejo_modulos">Ejercicios de manejo de m√≥dulos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/servidor_lamp">Instalaci√≥n de un servidor LAMP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/peticion_http">Peticiones HTTP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/virtualizacion_linux">Virtualizaci√≥n en Linux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/virtualhosting_apache">VirtualHosting con Apache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/parametros_kernel">Ejercicios de modificaci√≥n de par√°metros del k√©rnel</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/cliente_vpn">Configuraci√≥n del cliente VPN</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/compilacion_kernel">Compilaci√≥n de un Kernel linux a medida</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/nginx_php">Instalaci√≥n de nginx con PHP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/redes_openstack">Gesti√≥n de redes en OpenStack</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/apache2_fpm">Configuraci√≥n Apache2 + fpm+php</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/bind9_local">Instalaci√≥n y configuraci√≥n del servidor bind9 en nuestra red local</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/bookmedik">Instalaci√≥n de la aplicaci√≥n BookMedik</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/cifrado_asimetrico">Cifrado asim√©trico con gpg y openssl</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/escenario_openstack">Escenario en OpenStack</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/interconexion_bbdd">Interconexi√≥n de Servidores de Bases de Datos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/lemp">Instalaci√≥n de un servidor LEMP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/migracion_centos">Migraci√≥n CentOS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/plsql_basica">PRIMER BOLET√çN PL/SQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/tomcat">Desarrollo y despliegue de una aplicaci√≥n Java simple</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/wordpress">Instalaci√≥n de WordPress</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/apache_wsgi">Desplegando aplicaciones flask con apache2 + mod_wsgi</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/criptografia1">Cifrado asim√©trico con gpg y openssl</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Tasks/https">Configuraci√≥n de HTTPS en el VPS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/migracion_php">Instalaci√≥n/migraci√≥n de aplicaciones web PHP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/criptografia2">Criptograf√≠a II: Integridad, firmas y autenticaci√≥n</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/nfs_systemd">Montaje NFS mediante systemd</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tasks/markdown-features">Markdown Features</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/extras">Extras</a><button aria-label="Toggle the collapsible sidebar category &#x27;Extras&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/tasks"><span itemprop="name">Tasks</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Configuraci√≥n de HTTPS en el VPS</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Configuraci√≥n de HTTPS en el VPS</h1><p>Vamos a configurar el protocolo HTTPS para el acceso a nuestras aplicaciones, para ello tienes que tener en cuenta los siguiente:</p><ol><li>Vamos a utilizar el servicio letsencrypt para solicitar los certificados de nuestras p√°ginas.</li></ol><ol start="2"><li>Comprueba que el navegador tiene el certificado de Let‚Äôs Encrypt.</li></ol><ol start="3"><li>Solicita un certificado en Let‚Äôs Encrypt. Tienes dos opciones:</li></ol><ul><li><p>Solicitar un certificado para el nombre que tienes: <a href="http://www.tudominio.algo" target="_blank" rel="noopener noreferrer">www.tudominio.algo</a>.</p></li><li><p>Solicitar un certificado wildcard *.tudominio.algo que te sirve para todos tus nombres. (Esta opci√≥n te dar√° m√°s puntos).</p></li></ul><ol start="4"><li>Utiliza dos ficheros de configuraci√≥n de nginx: uno para la configuraci√≥n del virtualhost HTTP y otro para la configuraci√≥n del virtualhost HTTPS.</li></ol><ol start="5"><li>Realiza una redirecci√≥n o una reescritura para que cuando accedas a HTTP te redirija al sitio HTTPS.</li></ol><ol start="6"><li>Comprueba que se ha creado una tarea cron que renueva el certificado cada 3 meses.</li></ol><ol start="7"><li>Comprueba que las p√°ginas son accesible por HTTPS y visualiza los detalles del certificado que has creado.</li></ol><ol start="8"><li>Modifica la configuraci√≥n del cliente de NextCloud para comprobar que sigue en funcionamiento con HTTPS.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="procedimientos">Procedimientos<a class="hash-link" href="#procedimientos" title="Direct link to heading">‚Äã</a></h2><p>El primer paso para obtener el certificado ser√° instalar <code>cerbot</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install certbot</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Lo siguiente ser√° dejar libre el puerto 80, para ello paramos el servidor nginx:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl stop nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Para solicitar el <strong>wildcard</strong> hay que ejecutar:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> certbot certonly </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--manual </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--preferred-challenges</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">dns </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--email belennazareth29@gmail.com </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--server https://acme-v02.api.letsencrypt.org/directory </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--agree-tos </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-d *.ottershell.es</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Los par√°metros del comando son los siguientes:</p><p>üê∏ certonly: obtiene o renueva un certificado, pero no lo instala.</p><p>üê∏ manual: obtiene el certificado de forma interactiva.</p><p>üê∏ preferred-challenges=dns: es la forma en la que se le indica a Let‚Äôs Encrypt que controlo en dominio (con DNS). Para ello pedir√° que creemos un registro DNS de tipo TXT en nuestro dominio.</p><p>üê∏ email: direcci√≥n de correo electr√≥nico para notificaciones importantes relacionadas con el certificado.</p><p>üê∏ server: el servidor de Let‚Äôs Encrypt contra el que se ejecutar√°n todas las operaciones.</p><p>üê∏ agree-tos: acepto los t√©rminos de servicio de Let‚Äôs Encrypt.</p><p>üê∏ d: dominio para el que quiero obtener el certificado. Lleva un asterisco, lo que indica que va a ser wildcard.</p><p>Al ejecutarlo nos da diferentes opciones:</p><ul><li>Primero pregunta si queremos compartir el correo con la EFF para que env√≠en informaci√≥n sobre su trabajo:</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Would you be willing to share your email address with the Electronic Frontier</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Foundation, a founding partner of the Let</span><span class="token string" style="color:#e3116c">&#x27;s Encrypt project and the non-profit</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">organization that develops Certbot? We&#x27;</span><span class="token plain">d like to send you email about our work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">encrypting the web, EFF news, campaigns, and ways to support digital freedom.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">es/</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">N</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">o: y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>La segunda ser√° que la IP desde la que estoy ejecutando el comando ser√° almacenada en registros p√∫bicos:</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NOTE: The IP of this machine will be publicly logged as having requested this</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">certificate. If you</span><span class="token string" style="color:#e3116c">&#x27;re running certbot in manual mode on a machine that is not</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">your server, please ensure you&#x27;</span><span class="token plain">re okay with that.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Are you OK with your IP being logged?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">es/</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">N</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">o: y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Lo siguiente que nos pide es que creemos una entrada en nuestro registro DNS de tipo TXT con los valores que nos da. El mensaje ser√° parecido a:</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Please deploy a DNS TXT record under the name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_acme-challenge.dominio with the following value:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">valor_ejemplo</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Before continuing, verify the record is deployed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Press Enter to Continue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Por √∫ltimo, al hacer <code>enter</code>, comprobar√° que todo est√© correcto y si es as√≠ nos dar√° la ruta en la que se encuentra el certificado:</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Waiting </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> verification</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Cleaning up challenges</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IMPORTANT NOTES:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - Congratulations</span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> Your certificate and chain have been saved at:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   /etc/letsencrypt/live/</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">dominio</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/fullchain.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Your key </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> has been saved at:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   /etc/letsencrypt/live/</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">dominio</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/privkey.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Your cert will expire on </span><span class="token number" style="color:#36acaa">2023</span><span class="token plain">-03-03. To obtain a new or tweaked</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   version of this certificate </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> the future, simply run certbot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   again. To non-interactively renew *all* of your certificates, run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token string" style="color:#e3116c">&quot;certbot renew&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - Your account credentials have been saved </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> your Certbot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   configuration directory at /etc/letsencrypt. You should </span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   secure backup of this folder now. This configuration directory will</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   also contain certificates and private keys obtained by Certbot so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   making regular backups of this folder is ideal.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - If you like Certbot, please consider supporting our work by:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Donating to ISRG / Let&#x27;s Encrypt:   https://letsencrypt.org/donate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Donating to EFF:                    https://eff.org/donate-le</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Comprobamos que se ha creado el cron, esto har√° que el certificado se renueve autom√°ticamente cada 3 meses:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat /etc/cron.d/certbot</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># /etc/cron.d/certbot: crontab entries for the certbot package</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Upstream recommends attempting renewal twice a day</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Eventually, this will be an opportunity to validate certificates</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># haven&#x27;t been revoked, etc.  Renewal will only occur if expiration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># is within 30 days.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Important Note!  This cronjob will NOT be executed if you are</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># running systemd as your init system.  If you are running systemd,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># the cronjob.timer function takes precedence over this cronjob.  For</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># more details, see the systemd.timer manpage, or use systemctl show</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># certbot.timer.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:#36acaa">SHELL</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:#36acaa">PATH</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> */12 * * * root </span><span class="token builtin class-name">test</span><span class="token plain"> -x /usr/bin/certbot -a </span><span class="token punctuation" style="color:#393A34">\</span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> -d /run/systemd/system </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> perl -e </span><span class="token string" style="color:#e3116c">&#x27;sleep int(rand(43200))&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> certbot -q renew</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>En el fichero <code>/etc/nginx/sites-available</code> creamos otro fichero, en este caso una copia del que ya ten√≠amos:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cp vps.conf vps-https.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Modificamos el fichero <code>vps.conf</code>:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">server </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen </span><span class="token number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">::</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">:80</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name www.ottershell.es</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">301</span><span class="token plain"> https://</span><span class="token variable" style="color:#36acaa">$host</span><span class="token variable" style="color:#36acaa">$request_uri</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Modificamos el fichero <code>vps-https.conf</code>:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">server </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen </span><span class="token number" style="color:#36acaa">443</span><span class="token plain"> ssl http2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">::</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">:443 ssl http2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name www.ottershell.es</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    root /var/www/html</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    index index.php index.html index.htm index.nginx-debian.html</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl    on</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_certificate    /etc/letsencrypt/live/ottershell.es/fullchain.pem</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_certificate_key    /etc/letsencrypt/live/ottershell.es/privkey.pem</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Es necesario importar el certificado de Let&#x27;s Encrypt si usamos google chrome.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="entrega">Entrega<a class="hash-link" href="#entrega" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-captura-de-pantalla-para-comprobar-que-el-navegador-tiene-el-certificado-de-lets-encrypt">1. Captura de pantalla para comprobar que el navegador tiene el certificado de Let‚Äôs Encrypt.<a class="hash-link" href="#1-captura-de-pantalla-para-comprobar-que-el-navegador-tiene-el-certificado-de-lets-encrypt" title="Direct link to heading">‚Äã</a></h3><p><img loading="lazy" alt="Term" src="/assets/images/httpsIAW3-55833aefd93fee26979230e27aa64cb0.png" width="1277" height="961" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-qu√©-opci√≥n-has-elegido-qu√©-pruebas-realiza-lets-encrypt-para-asegurar-que-somos-los-administradores-del-sitio-web-al-elegir-esa-opci√≥n">2. ¬øQu√© opci√≥n has elegido? ¬øQu√© pruebas realiza Let‚Äôs Encrypt para asegurar que somos los administradores del sitio web al elegir esa opci√≥n?<a class="hash-link" href="#2-qu√©-opci√≥n-has-elegido-qu√©-pruebas-realiza-lets-encrypt-para-asegurar-que-somos-los-administradores-del-sitio-web-al-elegir-esa-opci√≥n" title="Direct link to heading">‚Äã</a></h3><p>En mi caso he elegido la opci√≥n con wildcard. He podido comprobar que Let‚Äôs Encrypt, con este tipo de certificaci√≥n, pide que creemos un registro DNS de tipo TXT en nuestro dominio con un valor proporcionado por el mismo programa.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-entrega-la-configuraci√≥n-de-nginx-los-dos-ficheros-para-que-funcione-https-y-la-redirecci√≥n">3. Entrega la configuraci√≥n de nginx (los dos ficheros) para que funcione HTTPS y la redirecci√≥n.<a class="hash-link" href="#3-entrega-la-configuraci√≥n-de-nginx-los-dos-ficheros-para-que-funcione-https-y-la-redirecci√≥n" title="Direct link to heading">‚Äã</a></h3><p>Para la redirecci√≥n se ha creado el fichero <code>vps.conf</code> en <code>/etc/nginx/sites-available</code> con contenido:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">server </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen </span><span class="token number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">::</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">:80</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name www.ottershell.es</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">301</span><span class="token plain"> https://</span><span class="token variable" style="color:#36acaa">$host</span><span class="token variable" style="color:#36acaa">$request_uri</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Y un fichero para https llamado <code>vps-https.conf</code> <code>/etc/nginx/sites-available</code> con contenido:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">server </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen </span><span class="token number" style="color:#36acaa">443</span><span class="token plain"> ssl http2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">::</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">:443 ssl http2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name www.ottershell.es</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    root /var/www/html</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    index index.php index.html index.htm index.nginx-debian.html</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl    on</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_certificate    /etc/letsencrypt/live/ottershell.es/fullchain.pem</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_certificate_key    /etc/letsencrypt/live/ottershell.es/privkey.pem</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> /favicon.ico </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log_not_found off</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        access_log off</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> /robots.txt </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        allow all</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log_not_found off</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        access_log off</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> / </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin class-name">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">301</span><span class="token plain"> /portal</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    location /portal {</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#        try_files $uri $uri/ =404;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location ~ </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">.php$ </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        include snippets/fastcgi-php.conf</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fastcgi_pass unix:/run/php/php7.4-fpm.sock</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fastcgi_param SCRIPT_FILENAME </span><span class="token variable" style="color:#36acaa">$document_root</span><span class="token variable" style="color:#36acaa">$fastcgi_script_name</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        include fastcgi_params</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fastcgi_intercept_errors on</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fastcgi_request_buffering off</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location ~ /</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">.ht </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         deny all</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># nextcloud</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location ^~ /cloud </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># set max upload size and increase upload timeout:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        client_max_body_size 512M</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        client_body_timeout 300s</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fastcgi_buffers </span><span class="token number" style="color:#36acaa">64</span><span class="token plain"> 4K</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Enable gzip but do not remove ETag headers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">gzip</span><span class="token plain"> on</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gzip_vary on</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gzip_comp_level </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gzip_min_length </span><span class="token number" style="color:#36acaa">256</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gzip_proxied expired no-cache no-store private no_last_modified no_etag auth</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gzip_types application/atom+xml application/javascript application/json application/ld+json application/manifest+json application/rss+xml application/vnd.geo+json application/vnd.ms-fontobject application/wasm application/x-font-ttf application/x-web-app-manifest+json application/xhtml+xml application/xml font/opentype image/bmp image/svg+xml image/x-icon text/cache-manifest text/css text/plain text/vcard text/vnd.rim.location.xloc text/vtt text/x-component text/x-cross-domain-policy</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># HTTP response headers borrowed from cloud `.htaccess`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        add_header Referrer-Policy                      </span><span class="token string" style="color:#e3116c">&quot;no-referrer&quot;</span><span class="token plain">   always</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        add_header X-Content-Type-Options               </span><span class="token string" style="color:#e3116c">&quot;nosniff&quot;</span><span class="token plain">       always</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        add_header X-Download-Options                   </span><span class="token string" style="color:#e3116c">&quot;noopen&quot;</span><span class="token plain">        always</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        add_header X-Frame-Options                      </span><span class="token string" style="color:#e3116c">&quot;SAMEORIGIN&quot;</span><span class="token plain">    always</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        add_header X-Permitted-Cross-Domain-Policies    </span><span class="token string" style="color:#e3116c">&quot;none&quot;</span><span class="token plain">          always</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        add_header X-Robots-Tag                         </span><span class="token string" style="color:#e3116c">&quot;none&quot;</span><span class="token plain">          always</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        add_header X-XSS-Protection                     </span><span class="token string" style="color:#e3116c">&quot;1; mode=block&quot;</span><span class="token plain"> always</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Remove X-Powered-By, which is an information leak</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fastcgi_hide_header X-Powered-By</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        index index.php index.html /cloud/index.php</span><span class="token variable" style="color:#36acaa">$request_uri</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Rule borrowed from `.htaccess` to handle Microsoft DAV clients</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        location </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> /cloud </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$http_user_agent</span><span class="token plain"> ~ ^DavClnt </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token builtin class-name">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">302</span><span class="token plain"> /cloud/remote.php/webdav/</span><span class="token variable" style="color:#36acaa">$is_args</span><span class="token variable" style="color:#36acaa">$args</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Rules borrowed from `.htaccess` to hide certain paths from clients</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        location ~ ^/cloud/</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">?:build</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">tests</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">config</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">lib</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">3rdparty</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">templates</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">?:$</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token builtin class-name">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">404</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        location ~ ^/cloud/</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">?:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">.</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">autotest</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">occ</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">issue</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">indie</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">db_</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">console</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token builtin class-name">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">404</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        location ~ </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">.php</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">?:$</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># Required for legacy support</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            rewrite ^/cloud/</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">?</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">index</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">remote</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">public</span><span class="token operator" style="color:#393A34">|</span><span class="token function" style="color:#d73a49">cron</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">core</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">/ajax</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">/update</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">status</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">ocs</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">/v</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">updater</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">/.+</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">oc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ms</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">-provider</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">/.+</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">.+</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">/richdocumentscode</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">/proxy</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> /cloud/index.php</span><span class="token variable" style="color:#36acaa">$request_uri</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fastcgi_split_path_info ^</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">.+?</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">.php</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">/.*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token builtin class-name">set</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$path_info</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$fastcgi_path_info</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try_files </span><span class="token variable" style="color:#36acaa">$fastcgi_script_name</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">404</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            include fastcgi_params</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fastcgi_param SCRIPT_FILENAME </span><span class="token variable" style="color:#36acaa">$document_root</span><span class="token variable" style="color:#36acaa">$fastcgi_script_name</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fastcgi_param PATH_INFO </span><span class="token variable" style="color:#36acaa">$path_info</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic"># fastcgi_param HTTPS on;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fastcgi_param modHeadersAvailable </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic"># Avoid sending the security headers twice</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fastcgi_param front_controller_active </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Enable pretty urls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fastcgi_pass unix:/run/php/php7.4-fpm.sock</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fastcgi_intercept_errors on</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fastcgi_request_buffering off</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fastcgi_max_temp_file_size </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        location ~ </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">?:css</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">js</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">svg</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">gif</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">png</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">jpg</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">ico</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">wasm</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">tflite</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">map</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">$ </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try_files </span><span class="token variable" style="color:#36acaa">$uri</span><span class="token plain"> /cloud/index.php</span><span class="token variable" style="color:#36acaa">$request_uri</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            add_header Cache-Control </span><span class="token string" style="color:#e3116c">&quot;public, max-age=15778463&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            access_log off</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Optional: Don&#x27;t log access to assets</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            location ~ </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">.wasm$ </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                default_type application/wasm</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        location ~ </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">.woff2?$ </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try_files </span><span class="token variable" style="color:#36acaa">$uri</span><span class="token plain"> /cloud/index.php</span><span class="token variable" style="color:#36acaa">$request_uri</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            expires 7d</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic"># Cache-Control policy borrowed from `.htaccess`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            access_log off</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Optional: Don&#x27;t log access to assets</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Rule borrowed from `.htaccess`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        location /cloud/remote </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token builtin class-name">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">301</span><span class="token plain"> /cloud/remote.php</span><span class="token variable" style="color:#36acaa">$request_uri</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        location /cloud </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try_files </span><span class="token variable" style="color:#36acaa">$uri</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$uri</span><span class="token plain">/ /cloud/index.php</span><span class="token variable" style="color:#36acaa">$request_uri</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># portal</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location ^~ /portal </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># set max upload size and increase upload timeout:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        client_max_body_size 512M</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        client_body_timeout 300s</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fastcgi_buffers </span><span class="token number" style="color:#36acaa">64</span><span class="token plain"> 4K</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Enable gzip but do not remove ETag headers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">gzip</span><span class="token plain"> on</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gzip_vary on</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gzip_comp_level </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gzip_min_length </span><span class="token number" style="color:#36acaa">256</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gzip_proxied expired no-cache no-store private no_last_modified no_etag auth</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gzip_types application/atom+xml application/javascript application/json application/ld+json application/manifest+json application/rss+xml application/vnd.geo+json application/vnd.ms-fontobject application/wasm application/x-font-ttf application/x-web-app-manifest+json application/xhtml+xml application/xml font/opentype image/bmp image/svg+xml image/x-icon text/cache-manifest text/css text/plain text/vcard text/vnd.rim.location.xloc text/vtt text/x-component text/x-cross-domain-policy</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># HTTP response headers borrowed from portal `.htaccess`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        add_header Referrer-Policy                      </span><span class="token string" style="color:#e3116c">&quot;no-referrer&quot;</span><span class="token plain">   always</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        add_header X-Content-Type-Options               </span><span class="token string" style="color:#e3116c">&quot;nosniff&quot;</span><span class="token plain">       always</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        add_header X-Download-Options                   </span><span class="token string" style="color:#e3116c">&quot;noopen&quot;</span><span class="token plain">        always</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        add_header X-Frame-Options                      </span><span class="token string" style="color:#e3116c">&quot;SAMEORIGIN&quot;</span><span class="token plain">    always</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        add_header X-Permitted-Cross-Domain-Policies    </span><span class="token string" style="color:#e3116c">&quot;none&quot;</span><span class="token plain">          always</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        add_header X-Robots-Tag                         </span><span class="token string" style="color:#e3116c">&quot;none&quot;</span><span class="token plain">          always</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        add_header X-XSS-Protection                     </span><span class="token string" style="color:#e3116c">&quot;1; mode=block&quot;</span><span class="token plain"> always</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Remove X-Powered-By, which is an information leak</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fastcgi_hide_header X-Powered-By</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        index index.php index.html /portal/index.php</span><span class="token variable" style="color:#36acaa">$request_uri</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Rule borrowed from `.htaccess` to handle Microsoft DAV clients</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        location </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> /portal </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$http_user_agent</span><span class="token plain"> ~ ^DavClnt </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token builtin class-name">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">302</span><span class="token plain"> /portal/remote.php/webdav/</span><span class="token variable" style="color:#36acaa">$is_args</span><span class="token variable" style="color:#36acaa">$args</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Rules borrowed from `.htaccess` to hide certain paths from clients</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        location ~ ^/portal/</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">?:build</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">tests</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">config</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">lib</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">3rdparty</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">templates</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">?:$</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token builtin class-name">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">404</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        location ~ ^/portal/</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">?:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">.</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">autotest</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">occ</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">issue</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">indie</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">db_</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">console</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token builtin class-name">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">404</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        location ~ </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">.php</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">?:$</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># Required for legacy support</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            rewrite ^/portal/</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">?</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">index</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">remote</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">public</span><span class="token operator" style="color:#393A34">|</span><span class="token function" style="color:#d73a49">cron</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">core</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">/ajax</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">/update</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">status</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">ocs</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">/v</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">updater</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">/.+</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">oc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ms</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">-provider</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">/.+</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">.+</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">/richdocumentscode</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">/proxy</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> /portal/index.php</span><span class="token variable" style="color:#36acaa">$request_uri</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fastcgi_split_path_info ^</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">.+?</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">.php</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">/.*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token builtin class-name">set</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$path_info</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$fastcgi_path_info</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try_files </span><span class="token variable" style="color:#36acaa">$fastcgi_script_name</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">404</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            include fastcgi_params</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fastcgi_param SCRIPT_FILENAME </span><span class="token variable" style="color:#36acaa">$document_root</span><span class="token variable" style="color:#36acaa">$fastcgi_script_name</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fastcgi_param PATH_INFO </span><span class="token variable" style="color:#36acaa">$path_info</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic"># fastcgi_param HTTPS on;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fastcgi_param modHeadersAvailable </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic"># Avoid sending the security headers twice</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fastcgi_param front_controller_active </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Enable pretty urls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fastcgi_pass unix:/run/php/php7.4-fpm.sock</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fastcgi_intercept_errors on</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fastcgi_request_buffering off</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fastcgi_max_temp_file_size </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        location ~ </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">?:css</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">js</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">svg</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">gif</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">png</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">jpg</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">ico</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">wasm</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">tflite</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">map</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">$ </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try_files </span><span class="token variable" style="color:#36acaa">$uri</span><span class="token plain"> /portal/index.php</span><span class="token variable" style="color:#36acaa">$request_uri</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            add_header Cache-Control </span><span class="token string" style="color:#e3116c">&quot;public, max-age=15778463&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            access_log off</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Optional: Don&#x27;t log access to assets</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            location ~ </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">.wasm$ </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                default_type application/wasm</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        location ~ </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">.woff2?$ </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try_files </span><span class="token variable" style="color:#36acaa">$uri</span><span class="token plain"> /portal/index.php</span><span class="token variable" style="color:#36acaa">$request_uri</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            expires 7d</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic"># Cache-Control policy borrowed from `.htaccess`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            access_log off</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Optional: Don&#x27;t log access to assets</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Rule borrowed from `.htaccess`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        location /portal/remote </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token builtin class-name">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">301</span><span class="token plain"> /portal/remote.php</span><span class="token variable" style="color:#36acaa">$request_uri</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        location /portal </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try_files </span><span class="token variable" style="color:#36acaa">$uri</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$uri</span><span class="token plain">/ /portal/index.php</span><span class="token variable" style="color:#36acaa">$request_uri</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location /admin </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token builtin class-name">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">301</span><span class="token plain"> /portal</span><span class="token variable" style="color:#36acaa">$request_uri</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-entrega-la-configuraci√≥n-del-cron-donde-se-ve-que-se-har√°-la-renovaci√≥n-cada-3-meses">4. Entrega la configuraci√≥n del cron donde se ve que se har√° la renovaci√≥n cada 3 meses.<a class="hash-link" href="#4-entrega-la-configuraci√≥n-del-cron-donde-se-ve-que-se-har√°-la-renovaci√≥n-cada-3-meses" title="Direct link to heading">‚Äã</a></h3><p>La configuraci√≥n la crea <code>cerbot</code> autom√°ticamente y se encuentra en el fichero <code>/etc/cron.d/certbot</code>: </p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># /etc/cron.d/certbot: crontab entries for the certbot package</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Upstream recommends attempting renewal twice a day</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Eventually, this will be an opportunity to validate certificates</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># haven&#x27;t been revoked, etc.  Renewal will only occur if expiration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># is within 30 days.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Important Note!  This cronjob will NOT be executed if you are</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># running systemd as your init system.  If you are running systemd,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># the cronjob.timer function takes precedence over this cronjob.  For</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># more details, see the systemd.timer manpage, or use systemctl show</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># certbot.timer.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:#36acaa">SHELL</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:#36acaa">PATH</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> */12 * * * root </span><span class="token builtin class-name">test</span><span class="token plain"> -x /usr/bin/certbot -a </span><span class="token punctuation" style="color:#393A34">\</span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> -d /run/systemd/system </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> perl -e </span><span class="token string" style="color:#e3116c">&#x27;sleep int(rand(43200))&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> certbot -q renew</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-captura-de-pantalla-accediendo-a-las-dos-p√°ginas-con-https-captura-de-pantalla-con-los-detalles-del-certificado">5. Captura de pantalla accediendo a las dos p√°ginas con https. Captura de pantalla con los detalles del certificado.<a class="hash-link" href="#5-captura-de-pantalla-accediendo-a-las-dos-p√°ginas-con-https-captura-de-pantalla-con-los-detalles-del-certificado" title="Direct link to heading">‚Äã</a></h3><p>Entrando en <code>www.ottershell.es</code>:</p><p><img loading="lazy" alt="Term" src="/assets/images/httpsIAW3-2-2f016e0783ea9d1bd78747a167e72134.png" width="1277" height="981" class="img_ev3q"></p><p>Entrando en <code>www.ottershell.es/cloud</code>:</p><p><img loading="lazy" alt="Term" src="/assets/images/httpsIAW3-3-d59f6aa5976eafd243b511143ab44887.png" width="1277" height="981" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-captura-de-pantalla-donde-se-vea-el-cliente-de-nextcloud-conectado-por-https">6. Captura de pantalla donde se vea el cliente de NextCloud conectado por https.<a class="hash-link" href="#6-captura-de-pantalla-donde-se-vea-el-cliente-de-nextcloud-conectado-por-https" title="Direct link to heading">‚Äã</a></h3><p>Entrando en la aplicaci√≥n, si entramos en <code>ajustes</code> podemos comprobar que se ha realizado la redirecci√≥n <strong>https</strong>:</p><p><img loading="lazy" alt="Term" src="/assets/images/httpsIAW3-4-594f75f7c75db850871a89fe6a6b6a0d.png" width="1166" height="723" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/belennazareth/ottershell/blob/main/docs/Tasks/https.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Tasks/criptografia1"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Cifrado asim√©trico con gpg y openssl</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Tasks/migracion_php"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Instalaci√≥n/migraci√≥n de aplicaciones web PHP</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#procedimientos" class="table-of-contents__link toc-highlight">Procedimientos</a></li><li><a href="#entrega" class="table-of-contents__link toc-highlight">Entrega</a><ul><li><a href="#1-captura-de-pantalla-para-comprobar-que-el-navegador-tiene-el-certificado-de-lets-encrypt" class="table-of-contents__link toc-highlight">1. Captura de pantalla para comprobar que el navegador tiene el certificado de Let‚Äôs Encrypt.</a></li><li><a href="#2-qu√©-opci√≥n-has-elegido-qu√©-pruebas-realiza-lets-encrypt-para-asegurar-que-somos-los-administradores-del-sitio-web-al-elegir-esa-opci√≥n" class="table-of-contents__link toc-highlight">2. ¬øQu√© opci√≥n has elegido? ¬øQu√© pruebas realiza Let‚Äôs Encrypt para asegurar que somos los administradores del sitio web al elegir esa opci√≥n?</a></li><li><a href="#3-entrega-la-configuraci√≥n-de-nginx-los-dos-ficheros-para-que-funcione-https-y-la-redirecci√≥n" class="table-of-contents__link toc-highlight">3. Entrega la configuraci√≥n de nginx (los dos ficheros) para que funcione HTTPS y la redirecci√≥n.</a></li><li><a href="#4-entrega-la-configuraci√≥n-del-cron-donde-se-ve-que-se-har√°-la-renovaci√≥n-cada-3-meses" class="table-of-contents__link toc-highlight">4. Entrega la configuraci√≥n del cron donde se ve que se har√° la renovaci√≥n cada 3 meses.</a></li><li><a href="#5-captura-de-pantalla-accediendo-a-las-dos-p√°ginas-con-https-captura-de-pantalla-con-los-detalles-del-certificado" class="table-of-contents__link toc-highlight">5. Captura de pantalla accediendo a las dos p√°ginas con https. Captura de pantalla con los detalles del certificado.</a></li><li><a href="#6-captura-de-pantalla-donde-se-vea-el-cliente-de-nextcloud-conectado-por-https" class="table-of-contents__link toc-highlight">6. Captura de pantalla donde se vea el cliente de NextCloud conectado por https.</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Blog</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Presentaci√≥n</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Otters</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Contacto</a></li><li class="footer__item"><a href="https://github.com/belennazareth" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"> Bel√©n Nazareth Dur√°n Mel√©ndez <br> Copyright ¬© 2023 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.a31030ca.js"></script>
<script src="/assets/js/main.03ec692b.js"></script>
</body>
</html>